import{K as W,z as _,u as $,r as a,j as e,a as r,A as z,M as f,N as G,G as H,O as I}from"./index-4de74d33.js";import{S as k}from"./react-select.esm-f1dc1d86.js";import"./assertThisInitialized-471bc4b9.js";const Q=()=>{var F;const q=W(),c=_(),{progress:l,error:p}=$(s=>s.videos),[n,x]=a.useState(""),[b,y]=a.useState(""),[D,A]=a.useState([]),[o,j]=a.useState(null),[v,d]=a.useState([]),[S,O]=a.useState([]),[u,m]=a.useState(null),[g,N]=a.useState(null),[i,C]=a.useState({}),[w,T]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const P=(await z.get("/admin/categories")).data.data.map(h=>({value:h._id,label:h.name,subcategories:h.subcategories.map(E=>({value:E._id,label:E.name}))}));A(P)}catch(t){console.error("Failed to fetch categories:",t),f.showErrorToast("Failed to load categories.")}})()},[]);const U=s=>{j(s),d([]),O((s==null?void 0:s.subcategories)||[]),m(null),N(null)},M=()=>{var t;const s={};return n||(s.title="Title is required."),o||(s.category="Category is required."),u||(s.file="File is required."),(t=o==null?void 0:o.label)!=null&&t.toLowerCase().includes("audio")&&!g&&(s.audioThumbnail="Audio thumbnail image is required for audio files."),C(s),Object.keys(s).length===0},V=async s=>{if(s.preventDefault(),!!M()){T(!0);try{await c(G({title:n,file:u,category:o.value,subcategories:v.map(t=>t.value),description:b,audioThumbnail:g})).then(t=>{t.meta.requestStatus==="fulfilled"&&(f.showSuccessToast("File uploaded successfully!"),q("/dashboard/videos"),c(H()),B())})}catch(t){console.error(t),f.showErrorToast("Failed to upload video.")}finally{T(!1)}}},B=()=>{x(""),y(""),j(null),d([]),m(null),N(null),C({}),c(I())},L=!n||!o||!u||((F=o==null?void 0:o.label)==null?void 0:F.toLowerCase().includes("audio"))&&!g||w||l>0&&l<100;return e.jsx("div",{className:"mt-12 mb-8 flex justify-center",children:e.jsxs(r.Card,{className:"w-full max-w-4 shadow-lg",children:[e.jsx(r.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-red-800  to-indigo-600 p-6 rounded-t-lg",children:e.jsx(r.Typography,{variant:"h5",color:"white",className:"text-center",children:"Upload File"})}),e.jsxs(r.CardBody,{className:"p-6 space-y-6",children:[p&&e.jsx(r.Typography,{color:"red",className:"text-sm",children:p}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsx(k,{value:o,onChange:U,options:D,placeholder:"Select a category",isClearable:!0,className:"focus:ring focus:ring-indigo-500"}),i.category&&e.jsx(r.Typography,{color:"red",className:"text-sm mt-1",children:i.category})]}),S.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subcategories"}),e.jsx(k,{value:v,onChange:s=>d(s||[]),options:S,isMulti:!0,placeholder:"Select subcategories",className:"focus:ring focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:n,onChange:s=>x(s.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-indigo-500",placeholder:"Enter title"}),i.title&&e.jsx(r.Typography,{color:"red",className:"text-sm mt-1",children:i.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:b,onChange:s=>y(s.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-indigo-500",placeholder:"Enter description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"File"}),e.jsx("input",{type:"file",onChange:s=>m(s.target.files[0]),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-indigo-500"}),i.file&&e.jsx(r.Typography,{color:"red",className:"text-sm mt-1",children:i.file})]}),e.jsx(r.Button,{color:"indigo",fullWidth:!0,onClick:V,disabled:L,children:w?l>0?`Uploading... ${l}%`:"Please Wait...":"Upload File"})]})]})})};export{Q as default};
