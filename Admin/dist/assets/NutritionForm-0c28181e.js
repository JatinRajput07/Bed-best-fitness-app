import{r as u,j as e,a as s,a3 as W,A as D,_ as S,u as X,b as Y,K as J}from"./index-0d03aea4.js";import{P as Z}from"./PencilIcon-5a7f01a7.js";import{T as R}from"./TrashIcon-937e31f5.js";const ee=["Pre Breakfast","Post Breakfast","Pre Lunch","Post Lunch","Pre Dinner","Post Dinner","Before Sleep at Night","In Every 2-3 hours"],se=({onAddNutrition:F,users:v,loading:P,handleCancel:g,editData:n})=>{const[I,_]=u.useState((n==null?void 0:n.userId)||""),[f,d]=u.useState((n==null?void 0:n.mealTime)||""),[C,w]=u.useState((n==null?void 0:n.description)||""),[p,x]=u.useState({name:(n==null?void 0:n.name)||"",quantity:(n==null?void 0:n.quantity)||1}),[m,h]=u.useState({}),q=()=>{_(""),d(""),w(""),x({name:"",quantity:1}),h({})},T=r=>{r.preventDefault();let c={};if(I||(c.selectedUser="Please select a user"),f||(c.selectedCategory="Please select a category"),C||(c.description="Description is required"),p.name.trim()||(c.itemName="Item name is required"),h(c),Object.keys(c).length>0)return;const E={userId:I,category:f,description:C,items:[{name:p.name.trim(),quantity:p.quantity}]};(n!=null&&n._id?D.put(`/admin/nutrition/${n._id}`,E):D.post("/admin/nutrition",E)).then(y=>{y.data.status==="success"&&(F(y.data.data),q(),S.success(`Nutrition plan ${n!=null&&n._id?"updated":"added"} successfully!`))}).catch(y=>{var k,z;S.error(((z=(k=y==null?void 0:y.response)==null?void 0:k.data)==null?void 0:z.message)||`Failed to ${n!=null&&n._id?"update":"add"} nutrition plan`)})};return e.jsxs(s.Dialog,{open:!0,size:"lg",handler:g,dismiss:{enabled:!1},className:"rounded-lg",children:[e.jsx(s.DialogHeader,{className:"bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(s.Typography,{variant:"h5",className:"font-bold",children:n?"Edit Nutrition Plan":"Add New Nutrition Plan"}),e.jsx("button",{onClick:g,className:"hover:bg-white/10 p-1 rounded-full",children:e.jsx(W,{className:"h-5 w-5"})})]})}),e.jsx(s.DialogBody,{className:"p-6",children:e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(s.Select,{label:"Select User",value:I,onChange:r=>{_(r),h(c=>({...c,selectedUser:!1}))},error:!!m.selectedUser,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"before:content-none after:content-none"},children:v.filter(r=>(r==null?void 0:r.role)==="user").map(r=>e.jsx(s.Option,{value:r._id,className:"hover:bg-blue-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:r.name}),r.email&&e.jsxs("span",{className:"text-xs text-gray-500 truncate",children:["(",r.email,")"]})]})},r._id))}),m.selectedUser&&e.jsx(s.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:m.selectedUser})]}),e.jsxs("div",{children:[e.jsx(s.Select,{label:"Meal Time Category",value:f,onChange:r=>{d(r),h(c=>({...c,selectedCategory:!1}))},error:!!m.selectedCategory,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"before:content-none after:content-none"},children:ee.map(r=>e.jsx(s.Option,{value:r,className:"hover:bg-blue-50",children:r},r))}),m.selectedCategory&&e.jsx(s.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:m.selectedCategory})]})]}),e.jsxs("div",{children:[e.jsx(s.Textarea,{label:"Description",value:C,onChange:r=>{w(r.target.value),h(c=>({...c,description:!1}))},error:!!m.description,className:"!border !border-gray-300 focus:!border-blue-500",rows:3,labelProps:{className:"before:content-none after:content-none"}}),m.description&&e.jsx(s.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:m.description})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx(s.Typography,{variant:"h6",color:"blue-gray",className:"mb-4 font-semibold",children:"Nutrition Item Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(s.Input,{label:"Item Name",value:p.name,onChange:r=>{x(c=>({...c,name:r.target.value})),h(c=>({...c,itemName:!1}))},error:!!m.itemName,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"before:content-none after:content-none"}}),m.itemName&&e.jsx(s.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:m.itemName})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Typography,{variant:"small",className:"font-medium text-gray-700",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(s.Button,{variant:"outlined",size:"sm",color:"blue-gray",className:"w-10 h-10 flex items-center justify-center p-0",onClick:()=>x(r=>({...r,quantity:Math.max(1,r.quantity-1)})),children:"-"}),e.jsx(s.Typography,{className:"w-8 text-center font-bold",children:p.quantity}),e.jsx(s.Button,{variant:"outlined",size:"sm",color:"blue-gray",className:"w-10 h-10 flex items-center justify-center p-0",onClick:()=>x(r=>({...r,quantity:r.quantity+1})),children:"+"})]})]})]})]})]})}),e.jsx(s.DialogFooter,{className:"bg-gray-50 px-6 py-4 rounded-b-lg border-t",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(s.Button,{variant:"text",color:"gray",onClick:g,className:"border border-gray-300 hover:bg-gray-100",children:"Cancel"}),e.jsx(s.Button,{color:"blue",onClick:T,disabled:P,className:"shadow-md hover:shadow-lg transition-all",children:P?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):n?"Update Plan":"Add Plan"})]})})]})},te=()=>{var U,$,O;const[F,v]=u.useState([]),[P,g]=u.useState([]),[n,I]=u.useState(""),[_,f]=u.useState(!1),[d,C]=u.useState(null),[w,p]=u.useState(null),[x,m]=u.useState(null),[h,q]=u.useState(1),[T,r]=u.useState(5),{users:c,loading:E}=X(a=>a.users),[L,y]=u.useState(!1),k=Y(),z=()=>{f(!1),p(null)},M=()=>{y(!0),D.get("/admin/nutrition").then(a=>{if(a.data.status==="success"){const i=a.data.data.sort((t,l)=>{var o,j,N,b;return(((o=t==null?void 0:t.userDetails)==null?void 0:o.name)||((j=t==null?void 0:t.userDetails)==null?void 0:j.email)).localeCompare(((N=l==null?void 0:l.userDetails)==null?void 0:N.name)||((b=l==null?void 0:l.userDetails)==null?void 0:b.email))});v(i),g(i),i.length>0&&C(i[0])}else v([]),g([])}).catch(a=>{console.error("Error fetching nutrition data:",a),S.error("Failed to fetch nutrition data.")}).finally(()=>{y(!1)})};u.useEffect(()=>{k(J({})),M()},[k]);const G=a=>{if(!a||typeof a!="object"||!a._id){S.error("Invalid nutrition data.");return}v(i=>(w?i.map(l=>l._id===a._id?a:l):[...i,a]).sort((l,o)=>{var j,N,b,B;return(((j=l==null?void 0:l.userDetails)==null?void 0:j.name)||((N=l==null?void 0:l.userDetails)==null?void 0:N.email)||"").localeCompare(((b=o==null?void 0:o.userDetails)==null?void 0:b.name)||((B=o==null?void 0:o.userDetails)==null?void 0:B.email))})),g(i=>(w?i.map(l=>l._id===a._id?a:l):[...i,a]).sort((l,o)=>{var j,N,b,B;return(((j=l==null?void 0:l.userDetails)==null?void 0:j.name)||((N=l==null?void 0:l.userDetails)==null?void 0:N.email)||"").localeCompare(((b=o==null?void 0:o.userDetails)==null?void 0:b.name)||((B=o==null?void 0:o.userDetails)==null?void 0:B.email))})),f(!1),p(null),M()},K=()=>{x&&D.delete(`/admin/nutrition/${x}`).then(a=>{a.data.status==="success"&&(v(i=>i.filter(t=>t._id!==x)),g(i=>i.filter(t=>t._id!==x)),S.success("Nutrition plan deleted successfully."))}).catch(a=>{console.error("Error deleting nutrition plan:",a),S.error("Failed to delete nutrition plan.")}).finally(()=>m(null))},V=a=>{const i=a.target.value.toLowerCase();I(i),g(F.filter(t=>{var l,o;return(((l=t==null?void 0:t.userDetails)==null?void 0:l.name)||((o=t==null?void 0:t.userDetails)==null?void 0:o.email)).toLowerCase().includes(i)})),q(1)},A=Math.ceil(P.length/T),H=P.slice((h-1)*T,h*T),Q=a=>{a>0&&a<=A&&q(a)};return e.jsxs("div",{className:"mt-8 mb-8 flex flex-col items-center",children:[e.jsxs(s.Card,{className:"w-full max-w-6xl shadow-lg mb-6",children:[e.jsxs(s.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-blue-600 to-indigo-800 p-6 rounded-t-lg flex justify-between items-center",children:[e.jsx(s.Typography,{variant:"h5",color:"white",className:"font-bold",children:"Nutrition Management"}),e.jsx(s.Button,{color:"white",onClick:()=>f(!0),className:"shadow-md hover:shadow-lg transition-all",children:"Add Nutrition Plan"})]}),_?e.jsx(se,{onAddNutrition:G,users:c,loading:E,handleCancel:z,editData:w}):e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"w-full md:w-1/4 border-r p-4 bg-gray-50",children:[e.jsx("div",{className:"mb-6",children:e.jsx(s.Input,{type:"text",placeholder:"Search users...",value:n,onChange:V,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"hidden"},containerProps:{className:"min-w-[100px]"}})}),L?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(s.Typography,{variant:"small",className:"text-gray-600",children:"Loading users..."})}):H.length>0?e.jsx("div",{className:"space-y-2",children:H.map((a,i)=>{var t,l;return e.jsx("div",{className:`p-3 cursor-pointer rounded-lg transition-all ${(d==null?void 0:d.userId)===a.userId?"bg-blue-100 border-l-4 border-blue-500":"hover:bg-gray-100 border-l-4 border-transparent"}`,onClick:()=>C(a),children:e.jsxs(s.Typography,{variant:"small",className:"font-semibold",children:[i+1,". ",((t=a==null?void 0:a.userDetails)==null?void 0:t.name)||((l=a==null?void 0:a.userDetails)==null?void 0:l.email)]})},a.userId)})}):e.jsx("div",{className:"p-4 text-center bg-gray-100 rounded-lg",children:e.jsx(s.Typography,{variant:"small",className:"text-gray-600",children:"No users found"})}),A>1&&e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(s.Button,{variant:"outlined",color:"blue",size:"sm",onClick:()=>Q(h-1),disabled:h===1,children:"Previous"}),e.jsxs(s.Typography,{variant:"small",color:"gray",children:["Page ",h," of ",A]}),e.jsx(s.Button,{variant:"outlined",color:"blue",size:"sm",onClick:()=>Q(h+1),disabled:h===A,children:"Next"})]})]}),e.jsx("div",{className:"w-full md:w-3/4 p-4",children:L?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(s.Typography,{variant:"small",className:"text-gray-600",children:"Loading nutrition details..."})}):d?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx(s.Typography,{variant:"h6",color:"blue-gray",className:"font-bold",children:((U=d==null?void 0:d.userDetails)==null?void 0:U.name)||(($=d==null?void 0:d.userDetails)==null?void 0:$.email)}),e.jsx(s.Typography,{variant:"small",color:"gray",children:"Nutrition Plan Details"})]}),(O=d==null?void 0:d.mealTimeGroups)==null?void 0:O.map((a,i)=>e.jsxs(s.Card,{className:"mb-6 shadow-sm border",children:[e.jsx(s.CardHeader,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 border-b",floated:!1,shadow:!1,children:e.jsx(s.Typography,{variant:"h6",color:"blue-gray",className:"font-semibold uppercase",children:a.mealTime})}),e.jsx(s.CardBody,{className:"p-0",children:a.nutritionDetails.map((t,l)=>e.jsx("div",{className:"border-b last:border-none p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(s.Typography,{variant:"h6",className:"font-semibold text-blue-800",children:t.name}),t.description&&e.jsx(s.Typography,{variant:"small",className:"text-gray-600 mt-1",children:t.description})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[e.jsx("div",{className:"bg-blue-50 px-3 py-1 rounded-full",children:e.jsxs(s.Typography,{variant:"small",className:"font-semibold text-blue-800",children:["Qty: ",t.quantity]})}),e.jsx("div",{className:"bg-green-50 px-3 py-1 rounded-full",children:e.jsxs(s.Typography,{variant:"small",className:"font-semibold text-green-800",children:["Consumed: ",t.consumed||0]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s.Button,{variant:"text",color:"blue",size:"sm",className:"p-1",onClick:()=>{p({...t,userId:d.userId}),f(!0)},children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(s.Button,{variant:"text",color:"red",size:"sm",className:"p-1",onClick:()=>m(t._id),children:e.jsx(R,{className:"h-4 w-4"})})]})]})]})},l))})]},i))]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(s.Typography,{variant:"h6",color:"gray",className:"mb-2",children:"No user selected"}),e.jsx(s.Typography,{variant:"small",color:"gray",children:"Select a user from the list to view nutrition details"})]})})]})]}),e.jsxs(s.Dialog,{open:!!x,handler:()=>m(null),children:[e.jsx(s.DialogHeader,{className:"bg-gray-100 text-center py-4",children:e.jsx(s.Typography,{variant:"h5",color:"blue-gray",className:"font-semibold",children:"Confirm Deletion"})}),e.jsxs(s.DialogBody,{className:"flex flex-col items-center gap-6 p-6",children:[e.jsx("div",{className:"p-4 rounded-full bg-red-100 flex justify-center items-center",children:e.jsx(R,{className:"h-10 w-10 text-red-500"})}),e.jsx(s.Typography,{className:"text-center text-base font-medium text-blue-gray-600",children:"Are you sure you want to delete this nutrition item? This action cannot be undone."})]}),e.jsxs(s.DialogFooter,{className:"bg-gray-50 flex justify-center gap-4 py-4",children:[e.jsx(s.Button,{variant:"outlined",color:"blue-gray",onClick:()=>m(null),className:"w-24",children:"Cancel"}),e.jsx(s.Button,{variant:"gradient",color:"red",onClick:K,className:"w-24",children:"Delete"})]})]})]})};export{te as default};
