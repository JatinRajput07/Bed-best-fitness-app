import{r as u,j as e,a as s,A,_ as T,u as K,b as Y,K as J}from"./index-bd53f385.js";import{P as V}from"./PencilIcon-15504e88.js";import{T as Q}from"./TrashIcon-9819fe55.js";const W=["Pre Breakfast","Post Breakfast","Pre Lunch","Post Lunch","Pre Dinner","Post Dinner","Before Sleep at Night","In Every 2-3 hours"],X=({onAddNutrition:D,users:w,loading:_,handleCancel:g,editData:r})=>{const[P,E]=u.useState((r==null?void 0:r.userId)||""),[f,x]=u.useState((r==null?void 0:r.mealTime)||""),[b,I]=u.useState((r==null?void 0:r.description)||""),[y,p]=u.useState({name:(r==null?void 0:r.name)||"",quantity:(r==null?void 0:r.quantity)||1}),[d,h]=u.useState({}),B=()=>{E(""),x(""),I(""),p({name:"",quantity:1}),h({})},k=n=>{n.preventDefault();let c={};if(P||(c.selectedUser="User selection is required."),f||(c.selectedCategory="Category selection is required."),b||(c.description="Description is required."),y.name.trim()||(c.itemName="Item name is required."),h(c),Object.keys(c).length>0)return;const F={userId:P,category:f,description:b,items:[{name:y.name.trim(),quantity:y.quantity}]};r!=null&&r._id?A.put(`/admin/nutrition/${r._id}`,F).then(m=>{m.data.status==="success"&&(D(m.data.data),B(),T.success("Nutrition plan updated successfully."))}).catch(m=>{var j,N;T.error(((N=(j=m==null?void 0:m.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to update nutrition plan.")}):A.post("/admin/nutrition",F).then(m=>{m.data.status==="success"&&(D(m.data.data),B(),T.success("Nutrition plan added successfully."))}).catch(m=>{var j,N;T.error(((N=(j=m==null?void 0:m.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to add nutrition plan.")})};return e.jsxs(s.Dialog,{open:!0,size:"lg",handler:g,dismiss:{enabled:!1},children:[e.jsx(s.DialogHeader,{children:r?"Edit Nutrition Plan":"Add Nutrition Plan"}),e.jsx(s.DialogBody,{children:e.jsx("form",{onSubmit:k,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(s.Select,{label:"Select User",value:P,onChange:n=>{E(n),h(c=>({...c,selectedUser:!1}))},error:!!d.selectedUser,children:w.map(n=>e.jsx(s.Option,{value:n._id,children:n.name},n._id))}),d.selectedUser&&e.jsx(s.Typography,{variant:"small",color:"red",className:"mt-1",children:d.selectedUser})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(s.Select,{label:"Select Category",value:f,onChange:n=>{x(n),h(c=>({...c,selectedCategory:!1}))},error:!!d.selectedCategory,children:W.map((n,c)=>e.jsx(s.Option,{value:n,children:n},c))}),d.selectedCategory&&e.jsx(s.Typography,{variant:"small",color:"red",className:"mt-1",children:d.selectedCategory})]})]}),e.jsxs("div",{children:[e.jsx(s.Textarea,{label:"Description",value:b,onChange:n=>{I(n.target.value),h(c=>({...c,description:!1}))},error:!!d.description}),d.description&&e.jsx(s.Typography,{variant:"small",color:"red",className:"mt-1",children:d.description})]}),e.jsxs("div",{children:[e.jsx(s.Typography,{variant:"h6",children:"Item"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx(s.Input,{placeholder:"Item Name",value:y.name,onChange:n=>{p(c=>({...c,name:n.target.value})),h(c=>({...c,itemName:!1}))},error:!!d.itemName}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(s.Button,{variant:"text",onClick:()=>p(n=>({...n,quantity:Math.max(1,n.quantity-1)})),children:"-"}),e.jsx(s.Typography,{children:y.quantity}),e.jsx(s.Button,{variant:"text",onClick:()=>p(n=>({...n,quantity:n.quantity+1})),children:"+"})]})]}),d.itemName&&e.jsx(s.Typography,{variant:"small",color:"red",className:"mt-1",children:d.itemName})]})]})})}),e.jsxs(s.DialogFooter,{children:[e.jsx(s.Button,{variant:"text",onClick:g,className:"mr-2",children:"Cancel"}),e.jsx(s.Button,{color:"blue",onClick:k,disabled:_,children:r?"Update":"Submit"})]})]})},te=()=>{var O;const[D,w]=u.useState([]),[_,g]=u.useState([]),[r,P]=u.useState(""),[E,f]=u.useState(!1),[x,b]=u.useState(null),[I,y]=u.useState(null),[p,d]=u.useState(null),[h,B]=u.useState(1),[k,n]=u.useState(5),{users:c,loading:F}=K(t=>t.users),[m,j]=u.useState(!1),N=Y(),z=()=>{f(!1),y(null)},L=()=>{j(!0),A.get("/admin/nutrition").then(t=>{if(t.data.status==="success"){const i=t.data.data.sort((l,a)=>{var o,v,C,S;return(((o=l==null?void 0:l.userDetails)==null?void 0:o.name)||((v=l==null?void 0:l.userDetails)==null?void 0:v.email)).localeCompare(((C=a==null?void 0:a.userDetails)==null?void 0:C.name)||((S=a==null?void 0:a.userDetails)==null?void 0:S.email))});w(i),g(i),i.length>0&&b(i[0])}else w([]),g([])}).catch(t=>{console.error("Error fetching nutrition data:",t),T.error("Failed to fetch nutrition data.")}).finally(()=>{j(!1)})};u.useEffect(()=>{N(J({})),L()},[N]);const R=t=>{if(!t||typeof t!="object"||!t._id){T.error("Invalid nutrition data.");return}w(i=>(I?i.map(a=>a._id===t._id?t:a):[...i,t]).sort((a,o)=>{var v,C,S,q;return(((v=a==null?void 0:a.userDetails)==null?void 0:v.name)||((C=a==null?void 0:a.userDetails)==null?void 0:C.email)||"").localeCompare(((S=o==null?void 0:o.userDetails)==null?void 0:S.name)||((q=o==null?void 0:o.userDetails)==null?void 0:q.email))})),g(i=>(I?i.map(a=>a._id===t._id?t:a):[...i,t]).sort((a,o)=>{var v,C,S,q;return(((v=a==null?void 0:a.userDetails)==null?void 0:v.name)||((C=a==null?void 0:a.userDetails)==null?void 0:C.email)||"").localeCompare(((S=o==null?void 0:o.userDetails)==null?void 0:S.name)||((q=o==null?void 0:o.userDetails)==null?void 0:q.email))})),f(!1),y(null),L()},M=()=>{p&&A.delete(`/admin/nutrition/${p}`).then(t=>{t.data.status==="success"&&(w(i=>i.filter(l=>l._id!==p)),g(i=>i.filter(l=>l._id!==p)),T.success("Nutrition plan deleted successfully."))}).catch(t=>{console.error("Error deleting nutrition plan:",t),T.error("Failed to delete nutrition plan.")}).finally(()=>d(null))},G=t=>{const i=t.target.value.toLowerCase();P(i),g(D.filter(l=>{var a,o;return(((a=l==null?void 0:l.userDetails)==null?void 0:a.name)||((o=l==null?void 0:l.userDetails)==null?void 0:o.email)).toLowerCase().includes(i)})),B(1)},U=Math.ceil(_.length/k),$=_.slice((h-1)*k,h*k),H=t=>{t>0&&t<=U&&B(t)};return e.jsxs("div",{className:"mt-12 mb-8 flex flex-col items-center",children:[e.jsxs(s.Card,{className:"w-full max-w-6xl shadow-lg mb-6",children:[e.jsxs(s.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-red-800 to-indigo-600 p-6 rounded-t-lg flex justify-between items-center",children:[e.jsx(s.Typography,{variant:"h5",color:"white",children:"Nutrition Plans"}),e.jsx(s.Button,{color:"lightBlue",onClick:()=>f(!0),children:"Add Nutrition"})]}),E?e.jsx(X,{onAddNutrition:R,users:c,loading:F,handleCancel:z,editData:I}):e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"w-full md:w-1/4 border-r p-4",children:[e.jsx("div",{className:"mb-6",children:e.jsx(s.Input,{type:"text",placeholder:"Search by user name",value:r,onChange:G,className:"mb-4"})}),m?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(s.Typography,{variant:"small",className:"text-gray-600",children:"Please wait..."})}):$.length>0?$.map((t,i)=>{var l,a;return e.jsx("div",{className:`p-3 cursor-pointer rounded-lg mb-2 ${(x==null?void 0:x.userId)===t.userId?"bg-blue-100":"hover:bg-gray-100"}`,onClick:()=>b(t),children:e.jsxs(s.Typography,{variant:"small",className:"font-semibold",children:[i+1,". ",((l=t==null?void 0:t.userDetails)==null?void 0:l.name)||((a=t==null?void 0:t.userDetails)==null?void 0:a.email)]})},t.userId)}):e.jsx(s.Typography,{variant:"small",className:"text-gray-600 text-center",children:"No data found."}),U>1&&e.jsxs("div",{className:"flex justify-center items-center mt-6 space-x-4",children:[e.jsx(s.Button,{color:"gray",onClick:()=>H(h-1),disabled:h===1,children:"Previous"}),e.jsx(s.Typography,{children:`${h} / ${U}`}),e.jsx(s.Button,{color:"gray",onClick:()=>H(h+1),disabled:h===U,children:"Next"})]})]}),e.jsx("div",{className:"w-full md:w-3/4 p-4",children:m?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(s.Typography,{variant:"small",className:"text-gray-600",children:"Please wait..."})}):x?e.jsx("div",{children:(O=x==null?void 0:x.mealTimeGroups)==null?void 0:O.map((t,i)=>e.jsxs(s.Card,{className:"mt-6 mb-6 shadow-sm",children:[e.jsx(s.CardHeader,{className:"bg-gray-100 p-4",children:e.jsx(s.Typography,{variant:"h6",className:"text-gray-700",children:t.mealTime})}),e.jsx(s.CardBody,{className:"p-4",children:t.nutritionDetails.map((l,a)=>e.jsx("div",{className:"border-b last:border-none py-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[e.jsxs("div",{className:"w-96 mb-2 md:mb-0",children:[e.jsx(s.Typography,{variant:"small",className:"font-semibold",children:l.name}),e.jsx(s.Typography,{variant:"small",className:"text-gray-600",children:l.description})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center space-y-2 md:space-y-0 md:space-x-4",children:[e.jsxs(s.Typography,{variant:"small",children:["Quantity: ",l.quantity]}),e.jsxs(s.Typography,{variant:"small",children:["Taken: ",l.takenCount]}),e.jsxs(s.Typography,{variant:"small",children:["Skipped: ",l.skippedCount]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-sm font-semibold ${l.status==="completed"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:l.status}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(V,{className:"h-5 w-5 text-blue-500 cursor-pointer",onClick:()=>{y({...l,userId:x.userId}),f(!0)}}),e.jsx(Q,{className:"h-5 w-5 text-red-500 cursor-pointer",onClick:()=>d(l._id)})]})]})]})},a))})]},i))}):e.jsx(s.Typography,{variant:"h6",className:"text-gray-700 text-center",children:"Select a user to view details."})})]})]}),e.jsxs(s.Dialog,{open:!!p,handler:()=>d(null),children:[e.jsx(s.DialogHeader,{className:"bg-gray-100 text-center py-4",children:e.jsx(s.Typography,{variant:"h5",color:"blue-gray",className:"font-semibold",children:"Confirm Deletion"})}),e.jsxs(s.DialogBody,{className:"flex flex-col items-center gap-6 p-6",children:[e.jsx("div",{className:"p-4 rounded-full bg-red-100 flex justify-center items-center",children:e.jsx(Q,{className:"h-10 w-10 text-red-500"})}),e.jsx(s.Typography,{className:"text-center text-base font-medium text-blue-gray-600",children:"Are you sure you want to delete this nutrition plan?"})]}),e.jsxs(s.DialogFooter,{className:"bg-gray-50 flex justify-center gap-4 py-4",children:[e.jsx(s.Button,{variant:"outlined",color:"blue-gray",className:"w-24",onClick:()=>d(null),children:"Cancel"}),e.jsx(s.Button,{variant:"gradient",color:"red",className:"w-24",onClick:M,children:"Confirm"})]})]})]})};export{te as default};
