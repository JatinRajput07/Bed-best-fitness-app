import{r as m,A as k,_ as p,j as e,a as l,a3 as J,u as K,b as Z,M as ee}from"./index-4e0354f5.js";import{S as W}from"./react-select.esm-ce3ab631.js";import{P as Y}from"./PencilIcon-d7fd1f37.js";import{T as X}from"./TrashIcon-a030f79c.js";import"./assertThisInitialized-b01dd5f6.js";const se=["Pre Breakfast","Post Breakfast","Pre Lunch","Post Lunch","Pre Dinner","Post Dinner","Before Sleep at Night","In Every 2-3 hours"],ae=({onAddNutrition:Q,users:q,loading:A,handleCancel:g,editData:o})=>{var U,M;const[N,H]=m.useState(!1),[u,d]=m.useState((o==null?void 0:o.userId)||""),[v,z]=m.useState([]),[I,b]=m.useState((o==null?void 0:o.mealTime)||""),[C,f]=m.useState((o==null?void 0:o.description)||""),[F,B]=m.useState(""),[w,_]=m.useState({name:(o==null?void 0:o.name)||"",quantity:(o==null?void 0:o.quantity)||1}),[S,T]=m.useState({title:"",quantity:1,userId:""}),[i,j]=m.useState({}),R=()=>{H(!N)};m.useEffect(()=>{u&&D()},[N,u]);const D=()=>{k.get(`/admin/inventory/${u}`).then(s=>{s.data.status==="success"&&(z(s.data.data),B(""))}).catch(s=>{var a,n;p.error(((n=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:n.message)||`Failed to ${o!=null&&o._id?"update":"add"} nutrition plan`)})},V=()=>{d(""),b(""),f(""),_({name:"",quantity:1}),j({})},O=s=>{s.preventDefault();let a={};if(u||(a.selectedUser="Please select a user"),I||(a.selectedCategory="Please select a category"),C||(a.description="Description is required"),w.name.trim()||(a.itemName="Item name is required"),j(a),Object.keys(a).length>0)return;const n=v.find(c=>c.title===w.name.trim()),t={userId:u,inventoryId:n==null?void 0:n._id,category:I,description:C,items:[{name:w.name.trim(),quantity:w.quantity}]};(o!=null&&o._id?k.put(`/admin/nutrition/${o._id}`,t):k.post("/admin/nutrition",t)).then(c=>{c.data.status==="success"&&(Q(c.data.data),V(),p.success(`Nutrition plan ${o!=null&&o._id?"updated":"added"} successfully!`))}).catch(c=>{var x,h;p.error(((h=(x=c==null?void 0:c.response)==null?void 0:x.data)==null?void 0:h.message)||`Failed to ${o!=null&&o._id?"update":"add"} nutrition plan`)})},G=s=>{s.preventDefault(),S.title;const a={userId:u,quantity:S.quantity,title:S.title,inventoryId:F};k.post("/admin/inventory/add/",a).then(n=>{n.data.status==="success"&&(p.success("Inventory added successfully!"),H(!1),T({title:"",userId:""}))}).catch(n=>{var t,r;p.error(((r=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to add inventory")})},E=s=>{if(!s){p.success("Inventory id required!");return}k.delete(`/admin/inventory/delete/${s}`).then(a=>{a.data.status==="success"&&(p.success("Inventory deleted successfully!"),u&&D())}).catch(a=>{var n,t;p.error(((t=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to add inventory")})},P=q.filter(s=>s.role==="user").map(s=>({value:s._id,label:`${s.name} (${s.email})`})),$=v.map(s=>({value:s.title,label:s==null?void 0:s.title}));return e.jsxs(l.Dialog,{open:!0,size:"lg",handler:g,dismiss:{enabled:!1},className:"rounded-lg",children:[e.jsx(l.DialogHeader,{className:"bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(l.Typography,{variant:"h5",className:"font-bold",children:N?"Add Inventory":o?"Edit Nutrition Plan":"Add New Nutrition Plan"}),N?e.jsx(l.Button,{className:"bg-blue-600 hover:bg-blue-700 text-white rounded-full px-4 py-2  ml-auto",onClick:R,children:"Back"}):e.jsx(l.Button,{className:"bg-blue-600 hover:bg-blue-700 text-white rounded-full px-4 py-2  ml-auto",onClick:R,children:"Add & Manage Inventory"}),e.jsx("button",{onClick:g,className:"hover:bg-white/10 p-1 rounded-full",children:e.jsx(J,{className:"h-5 w-5"})})]})}),N?e.jsxs(l.DialogBody,{className:"p-6",children:[e.jsx("form",{onSubmit:G,className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(W,{options:P,value:P.find(s=>s.value===u),onChange:s=>{d(s.value),j(a=>({...a,selectedUser:!1}))},placeholder:"Select User",classNamePrefix:"react-select"}),i.selectedUser&&e.jsx(l.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:i.selectedUser})]}),e.jsxs("div",{children:[e.jsx(l.Input,{label:"Title",value:S.title,onChange:s=>{T(a=>({...a,title:s.target.value})),j(a=>({...a,itemName:!1}))},error:!!i.itemName,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"before:content-none after:content-none"}}),i.title&&e.jsx(l.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:i.title})]}),e.jsx(l.Input,{label:"Quantity",type:"number",value:S.quantity,onChange:s=>{T(a=>({...a,quantity:s.target.value}))},error:!!i.quantity,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"before:content-none after:content-none"}}),i.quantity&&e.jsx(l.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:i.quantity})]})}),e.jsx("hr",{className:"mt-3"}),v.length>0&&v.map(s=>e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs(l.Typography,{variant:"small",className:"font-medium text-gray-700",children:[s==null?void 0:s.title,"  - "]}),e.jsxs(l.Typography,{variant:"small",className:"font-semibold text-green-800",children:[(s==null?void 0:s.quantity)||0," "]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l.Button,{variant:"text",color:"blue",size:"sm",className:"p-1",onClick:()=>{B(s==null?void 0:s._id),T({title:s==null?void 0:s.title,quantity:s==null?void 0:s.quantity}),d(s==null?void 0:s.userId)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(l.Button,{variant:"text",color:"red",size:"sm",className:"p-1",onClick:()=>{E(s==null?void 0:s._id)},children:e.jsx(X,{className:"h-4 w-4"})})]})]}))]}):e.jsx(l.DialogBody,{className:"p-6",children:e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(W,{options:P,value:P.find(s=>s.value===u),onChange:s=>{d(s.value),j(a=>({...a,selectedUser:!1}))},placeholder:"Select User",classNamePrefix:"react-select"}),i.selectedUser&&e.jsx(l.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:i.selectedUser})]}),e.jsxs("div",{children:[e.jsx(l.Select,{label:"Meal Time Category",value:I,onChange:s=>{b(s),j(a=>({...a,selectedCategory:!1}))},error:!!i.selectedCategory,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"before:content-none after:content-none"},children:se.map(s=>e.jsx(l.Option,{value:s,className:"hover:bg-blue-50",children:s},s))}),i.selectedCategory&&e.jsx(l.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:i.selectedCategory})]})]}),e.jsxs("div",{children:[e.jsx(l.Textarea,{label:"Description",value:C,onChange:s=>{f(s.target.value),j(a=>({...a,description:!1}))},error:!!i.description,className:"!border !border-gray-300 focus:!border-blue-500",rows:3,labelProps:{className:"before:content-none after:content-none"}}),i.description&&e.jsx(l.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:i.description})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx(l.Typography,{variant:"h6",color:"blue-gray",className:"mb-4 font-semibold",children:"Nutrition Item Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(W,{options:$,value:$.find(s=>s.value===w.name),onChange:s=>{_(a=>({...a,name:s==null?void 0:s.value}))},placeholder:"Select Inventory",classNamePrefix:"react-select"}),((U=i==null?void 0:i.item)==null?void 0:U.name)&&e.jsx(l.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:(M=i==null?void 0:i.item)==null?void 0:M.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l.Typography,{variant:"small",className:"font-medium text-gray-700",children:"Dose"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l.Button,{variant:"outlined",size:"sm",color:"blue-gray",className:"w-10 h-10 flex items-center justify-center p-0",onClick:()=>_(s=>({...s,quantity:Math.max(1,s.quantity-1)})),children:"-"}),e.jsx(l.Typography,{className:"w-8 text-center font-bold",children:w.quantity}),e.jsx(l.Button,{variant:"outlined",size:"sm",color:"blue-gray",className:"w-10 h-10 flex items-center justify-center p-0",onClick:()=>_(s=>({...s,quantity:s.quantity+1})),children:"+"})]})]})]})]})]})}),e.jsx(l.DialogFooter,{className:"bg-gray-50 px-6 py-4 rounded-b-lg border-t",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(l.Button,{variant:"text",color:"gray",onClick:g,className:"border border-gray-300 hover:bg-gray-100",children:"Cancel"}),e.jsx(l.Button,{color:"blue",onClick:N?G:O,disabled:A,className:"shadow-md hover:shadow-lg transition-all",children:A?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):N?F?"Update Inventory":"Add Inventory":o?"Update Plan":"Add Plan"})]})})]})},ce=()=>{var U,M,s;const[Q,q]=m.useState([]),[A,g]=m.useState([]),[o,N]=m.useState(""),[H,u]=m.useState(!1),[d,v]=m.useState(null),[z,I]=m.useState(null),[b,C]=m.useState(null),[f,F]=m.useState(1),[B,w]=m.useState(10),{users:_,loading:S}=K(a=>a.users),[T,i]=m.useState(!1),j=Z(),R=()=>{u(!1),I(null)},D=()=>{i(!0),k.get("/admin/nutrition").then(a=>{if(a.data.status==="success"){const n=a.data.data.sort((t,r)=>{var c,x,h,y;return(((c=t==null?void 0:t.userDetails)==null?void 0:c.name)||((x=t==null?void 0:t.userDetails)==null?void 0:x.email)).localeCompare(((h=r==null?void 0:r.userDetails)==null?void 0:h.name)||((y=r==null?void 0:r.userDetails)==null?void 0:y.email))});if(q(n),g(n),n.length>0)if(!d)v(n[0]);else{const t=n.find(r=>r.userId===d.userId);t&&v(t)}}else q([]),g([])}).catch(a=>{console.error("Error fetching nutrition data:",a),p.error("Failed to fetch nutrition data.")}).finally(()=>{i(!1)})};m.useEffect(()=>{j(ee({})),D()},[j]);const V=a=>{if(!a||typeof a!="object"||!a._id){p.error("Invalid nutrition data.");return}q(n=>(z?n.map(r=>r._id===a._id?a:r):[...n,a]).sort((r,c)=>{var x,h,y,L;return(((x=r==null?void 0:r.userDetails)==null?void 0:x.name)||((h=r==null?void 0:r.userDetails)==null?void 0:h.email)||"").localeCompare(((y=c==null?void 0:c.userDetails)==null?void 0:y.name)||((L=c==null?void 0:c.userDetails)==null?void 0:L.email))})),g(n=>(z?n.map(r=>r._id===a._id?a:r):[...n,a]).sort((r,c)=>{var x,h,y,L;return(((x=r==null?void 0:r.userDetails)==null?void 0:x.name)||((h=r==null?void 0:r.userDetails)==null?void 0:h.email)||"").localeCompare(((y=c==null?void 0:c.userDetails)==null?void 0:y.name)||((L=c==null?void 0:c.userDetails)==null?void 0:L.email))})),u(!1),I(null),D()},O=()=>{b&&k.delete(`/admin/nutrition/${b}`).then(a=>{a.data.status==="success"&&(q(n=>n.filter(t=>t._id!==b)),g(n=>n.filter(t=>t._id!==b)),D(),p.success("Nutrition plan deleted successfully."))}).catch(a=>{console.error("Error deleting nutrition plan:",a),p.error("Failed to delete nutrition plan.")}).finally(()=>C(null))},G=a=>{const n=a.target.value.toLowerCase();if(N(n),n==="")g(Q);else{const t=Q.filter(r=>{var h,y;const c=((h=r==null?void 0:r.userDetails)==null?void 0:h.name)||"",x=((y=r==null?void 0:r.userDetails)==null?void 0:y.email)||"";return(c+x).toLowerCase().includes(n)});g(t)}F(1)},E=Math.ceil(A.length/B),P=A.slice((f-1)*B,f*B),$=a=>{a>0&&a<=E&&F(a)};return e.jsxs("div",{className:"mt-8 mb-8 flex flex-col items-center",children:[e.jsxs(l.Card,{className:"w-full max-w-6xl shadow-lg mb-6",children:[e.jsxs(l.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-blue-600 to-indigo-800 p-6 rounded-t-lg flex justify-between items-center",children:[e.jsx(l.Typography,{variant:"h5",color:"white",className:"font-bold",children:"Nutrition Management"}),e.jsx(l.Button,{color:"white",onClick:()=>u(!0),className:"shadow-md hover:shadow-lg transition-all",children:"Add Nutrition Plan"})]}),H?e.jsx(ae,{onAddNutrition:V,users:_,loading:S,handleCancel:R,editData:z}):e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"w-full md:w-1/4 border-r p-4 bg-gray-50",children:[e.jsx("div",{className:"mb-6",children:e.jsx(l.Input,{type:"text",placeholder:"Search users...",value:o,onChange:G,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"hidden"},containerProps:{className:"min-w-[100px]"}})}),T?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(l.Typography,{variant:"small",className:"text-gray-600",children:"Loading users..."})}):P.length>0?e.jsx("div",{className:"space-y-2",children:P.map((a,n)=>{var t,r;return e.jsx("div",{className:`p-3 cursor-pointer rounded-lg transition-all ${(d==null?void 0:d.userId)===a.userId?"bg-blue-100 border-l-4 border-blue-500":"hover:bg-gray-100 border-l-4 border-transparent"}`,onClick:()=>v(a),children:e.jsxs(l.Typography,{variant:"small",className:"font-semibold",children:[n+1,". ",((t=a==null?void 0:a.userDetails)==null?void 0:t.name)||((r=a==null?void 0:a.userDetails)==null?void 0:r.email)]})},a.userId)})}):e.jsx("div",{className:"p-4 text-center bg-gray-100 rounded-lg",children:e.jsx(l.Typography,{variant:"small",className:"text-gray-600",children:"No users found"})}),E>1&&e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(l.Button,{variant:"outlined",color:"blue",size:"sm",onClick:()=>$(f-1),disabled:f===1,children:"Previous"}),e.jsxs(l.Typography,{variant:"small",color:"gray",children:["Page ",f," of ",E]}),e.jsx(l.Button,{variant:"outlined",color:"blue",size:"sm",onClick:()=>$(f+1),disabled:f===E,children:"Next"})]})]}),e.jsx("div",{className:"w-full md:w-3/4 p-4",children:T?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(l.Typography,{variant:"small",className:"text-gray-600",children:"Loading nutrition details..."})}):d?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx(l.Typography,{variant:"h6",color:"blue-gray",className:"font-bold",children:((U=d==null?void 0:d.userDetails)==null?void 0:U.name)||((M=d==null?void 0:d.userDetails)==null?void 0:M.email)}),e.jsx(l.Typography,{variant:"small",color:"gray",children:"Nutrition Plan Details"})]}),(s=d==null?void 0:d.mealTimeGroups)==null?void 0:s.map((a,n)=>e.jsxs(l.Card,{className:"mb-6 shadow-sm border",children:[e.jsx(l.CardHeader,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 border-b",floated:!1,shadow:!1,children:e.jsx(l.Typography,{variant:"h6",color:"blue-gray",className:"font-semibold uppercase",children:a.mealTime})}),e.jsx(l.CardBody,{className:"p-0",children:a.nutritionDetails.map((t,r)=>e.jsx("div",{className:"border-b last:border-none p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l.Typography,{variant:"h6",className:"font-semibold text-blue-800",children:t.name}),t.description&&e.jsx(l.Typography,{variant:"small",className:"text-gray-600 mt-1",children:t.description})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[e.jsx("div",{className:"bg-blue-50 px-3 py-1 rounded-full",children:e.jsxs(l.Typography,{variant:"small",className:"font-semibold text-blue-800",children:["Total Stock: ",t==null?void 0:t.stockQuantity]})}),e.jsx("div",{className:"bg-blue-50 px-3 py-1 rounded-full",children:e.jsxs(l.Typography,{variant:"small",className:"font-semibold text-blue-800",children:["Remaining Stock: ",(t==null?void 0:t.stockQuantity)-(t==null?void 0:t.takenCount)]})}),e.jsx("div",{className:"bg-green-50 px-3 py-1 rounded-full",children:e.jsxs(l.Typography,{variant:"small",className:"font-semibold text-green-800",children:["Used: ",(t==null?void 0:t.takenCount)||0]})}),e.jsx("div",{className:"bg-green-50 px-3 py-1 rounded-full",children:e.jsxs(l.Typography,{variant:"small",className:"font-semibold text-green-800",children:["Daily Dose: ",(t==null?void 0:t.quantity)||0]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l.Button,{variant:"text",color:"blue",size:"sm",className:"p-1",onClick:()=>{I({...t,userId:d.userId}),u(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(l.Button,{variant:"text",color:"red",size:"sm",className:"p-1",onClick:()=>C(t._id),children:e.jsx(X,{className:"h-4 w-4"})})]})]})]})},r))})]},n))]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(l.Typography,{variant:"h6",color:"gray",className:"mb-2",children:"No user selected"}),e.jsx(l.Typography,{variant:"small",color:"gray",children:"Select a user from the list to view nutrition details"})]})})]})]}),e.jsxs(l.Dialog,{open:!!b,handler:()=>C(null),children:[e.jsx(l.DialogHeader,{className:"bg-gray-100 text-center py-4",children:e.jsx(l.Typography,{variant:"h5",color:"blue-gray",className:"font-semibold",children:"Confirm Deletion"})}),e.jsxs(l.DialogBody,{className:"flex flex-col items-center gap-6 p-6",children:[e.jsx("div",{className:"p-4 rounded-full bg-red-100 flex justify-center items-center",children:e.jsx(X,{className:"h-10 w-10 text-red-500"})}),e.jsx(l.Typography,{className:"text-center text-base font-medium text-blue-gray-600",children:"Are you sure you want to delete this nutrition item? This action cannot be undone."})]}),e.jsxs(l.DialogFooter,{className:"bg-gray-50 flex justify-center gap-4 py-4",children:[e.jsx(l.Button,{variant:"outlined",color:"blue-gray",onClick:()=>C(null),className:"w-24",children:"Cancel"}),e.jsx(l.Button,{variant:"gradient",color:"red",onClick:O,className:"w-24",children:"Delete"})]})]})]})};export{ce as default};
