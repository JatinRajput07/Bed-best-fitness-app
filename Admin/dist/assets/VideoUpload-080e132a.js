import{R as g,a0 as R,b as M,u as V,r as h,j as r,a as m,A as $,a1 as w,a2 as H,Y as A,a3 as G}from"./index-5ca8910e.js";import{S as L}from"./react-select.esm-50c19f3e.js";import"./assertThisInitialized-75f96385.js";var D={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},T=g.createContext&&g.createContext(D),K=["attr","size","title"];function Y(e,i){if(e==null)return{};var a=J(e,i),l,t;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(t=0;t<d.length;t++)l=d[t],!(i.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function J(e,i){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(i.indexOf(l)>=0)continue;a[l]=e[l]}return a}function v(){return v=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},v.apply(this,arguments)}function W(e,i){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);i&&(l=l.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,l)}return a}function j(e){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?W(Object(a),!0).forEach(function(l){Q(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):W(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Q(e,i,a){return i=X(i),i in e?Object.defineProperty(e,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[i]=a,e}function X(e){var i=Z(e,"string");return typeof i=="symbol"?i:i+""}function Z(e,i){if(typeof e!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,i||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function B(e){return e&&e.map((i,a)=>g.createElement(i.tag,j({key:a},i.attr),B(i.child)))}function y(e){return i=>g.createElement(ee,v({attr:j({},e.attr)},i),B(e.child))}function ee(e){var i=a=>{var{attr:l,size:t,title:d}=e,x=Y(e,K),b=t||a.size||"1em",c;return a.className&&(c=a.className),e.className&&(c=(c?c+" ":"")+e.className),g.createElement("svg",v({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,l,x,{className:c,style:j(j({color:e.color||a.color},a.style),e.style),height:b,width:b,xmlns:"http://www.w3.org/2000/svg"}),d&&g.createElement("title",null,d),e.children)};return T!==void 0?g.createElement(T.Consumer,null,a=>i(a)):i(D)}function U(e){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"},child:[]},{tag:"polyline",attr:{points:"13 2 13 9 20 9"},child:[]}]})(e)}function te(e){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"},child:[]},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"},child:[]},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"},child:[]},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"},child:[]},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"},child:[]},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"},child:[]},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"},child:[]},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"},child:[]}]})(e)}function re(e){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},child:[]},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"},child:[]},{tag:"polyline",attr:{points:"21 15 16 10 5 21"},child:[]}]})(e)}function ae(e){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 18V5l12-2v13"},child:[]},{tag:"circle",attr:{cx:"6",cy:"18",r:"3"},child:[]},{tag:"circle",attr:{cx:"18",cy:"16",r:"3"},child:[]}]})(e)}function ie(e){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},child:[]},{tag:"polyline",attr:{points:"17 8 12 3 7 8"},child:[]},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"},child:[]}]})(e)}const oe=()=>{var k,S,E,F,_;const e=R(),i=M(),{progress:a,error:l}=V(s=>s.videos),[t,d]=h.useState({title:"",description:"",category:null,subcategories:null,file:null,thumbnail:null}),[x,b]=h.useState([]),[c,p]=h.useState({}),[O,C]=h.useState(!1);h.useEffect(()=>{(async()=>{try{const n=await $.get("/admin/categories");b(n.data.data)}catch{w.showErrorToast("Failed to load categories")}})()},[]),h.useEffect(()=>{if(t.file&&!t.title){const s=t.file.name.split(".")[0];d(n=>({...n,title:s}))}},[t.file]);const P=(s,n)=>{var f;const o=(f=s.target.files)==null?void 0:f[0];if(o){if(n==="file"&&t.category){const u=t.category.type;if(!o.type.startsWith(`${u}/`)){p(N=>({...N,file:`Please select a ${u} file`})),d(N=>({...N,[n]:null}));return}}if(n==="thumbnail"&&!o.type.startsWith("image/")){p(u=>({...u,thumbnail:"Please select an image file"})),d(u=>({...u,[n]:null}));return}d(u=>({...u,[n]:o})),p(u=>({...u,[n]:void 0}))}},I=()=>{var n;const s={};return t.title||(s.title="Title is required"),t.category||(s.category="Category is required"),t.file||(s.file="File is required"),(n=t.category)!=null&&n.type&&["audio","video"].includes(t.category.type)&&!t.thumbnail&&(s.thumbnail="Thumbnail is required"),p(s),Object.keys(s).length===0},q=async s=>{var o,f;if(s.preventDefault(),!I())return;C(!0);const n=new FormData;n.append("title",t.title),n.append("description",t.description),n.append("category",(o=t.category)==null?void 0:o._id),t.subcategories?n.append("subcategories[]",t.subcategories._id):n.append("subcategories",[]),t.file&&n.append("file",t.file),(f=t.category)!=null&&f.type&&["audio","video"].includes(t.category.type)&&t.thumbnail&&n.append("thumbnail",t.thumbnail);try{(await i(H(n))).meta.requestStatus==="fulfilled"&&(w.showSuccessToast("Upload successful!"),i(A()),e("/dashboard/videos"))}catch{w.showErrorToast("Upload failed")}finally{C(!1),i(G())}},z=()=>t.file?t.file.type.startsWith("audio/")?r.jsx(ae,{className:"h-10 w-10"}):t.file.type.startsWith("video/")?r.jsx(te,{className:"h-10 w-10"}):r.jsx(U,{className:"h-10 w-10"}):r.jsx(U,{className:"h-10 w-10"});return r.jsx("div",{className:"mt-12 mb-8 flex justify-center",children:r.jsxs(m.Card,{className:"w-full max-w-4xl shadow-lg",children:[r.jsx(m.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-red-800 to-indigo-600 p-6 rounded-t-lg",children:r.jsxs(m.Typography,{variant:"h5",color:"white",className:"flex items-center gap-2",children:[r.jsx(ie,{className:"h-5 w-5"}),"Upload File"]})}),r.jsxs(m.CardBody,{className:"p-6 space-y-6",children:[l&&r.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded-md text-sm",children:l}),r.jsxs("form",{onSubmit:q,className:"space-y-6",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Category *"}),r.jsx(L,{value:t.category?{value:t.category._id,label:t.category.name}:null,onChange:s=>{const n=s?x.find(o=>o._id===s.value):null;d(o=>({...o,category:n,subcategories:null,file:null,thumbnail:null})),p(o=>({...o,category:void 0,file:void 0,thumbnail:void 0}))},options:x.map(s=>({value:s._id,label:s.name})),placeholder:"Select a category",isClearable:!0}),c.category&&r.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.category})]}),((S=(k=t.category)==null?void 0:k.subcategories)==null?void 0:S.length)>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subcategory"}),r.jsx(L,{value:t.subcategories?{value:t.subcategories._id,label:t.subcategories.name}:null,onChange:s=>{const n=s?t.category.subcategories.find(o=>o._id===s.value):null;d(o=>({...o,subcategories:n}))},options:t.category.subcategories.map(s=>({value:s._id,label:s.name})),placeholder:"Select a subcategory",isClearable:!0})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Title *"}),r.jsx(m.Input,{type:"text",value:t.title,onChange:s=>d(n=>({...n,title:s.target.value})),placeholder:"Enter title",error:!!c.title}),c.title&&r.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.title})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description ( optional )"}),r.jsx(m.Textarea,{value:t.description,onChange:s=>d(n=>({...n,description:s.target.value})),placeholder:"Enter description",rows:4})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"File *"}),r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx("input",{type:"file",onChange:s=>P(s,"file"),accept:(E=t.category)!=null&&E.type?`${t.category.type}/*`:void 0,className:"hidden",id:"file-upload"}),r.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center justify-center space-y-2",children:[z(),r.jsx("p",{className:"text-sm text-gray-600",children:t.file?t.file.name:"Click to select a file"}),((F=t.category)==null?void 0:F.type)&&r.jsxs("p",{className:"text-xs text-gray-500",children:[t.category.type.toUpperCase()," files only"]})]})]}),c.file&&r.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.file})]}),((_=t.category)==null?void 0:_.type)&&["audio","video"].includes(t.category.type)&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Thumbnail *"}),r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx("input",{type:"file",onChange:s=>P(s,"thumbnail"),accept:"image/*",className:"hidden",id:"thumbnail-upload"}),r.jsxs("label",{htmlFor:"thumbnail-upload",className:"cursor-pointer flex flex-col items-center justify-center space-y-2",children:[r.jsx(re,{className:"h-10 w-10 text-gray-400"}),r.jsx("p",{className:"text-sm text-gray-600",children:t.thumbnail?t.thumbnail.name:"Click to select a thumbnail"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Required dimensions: 77px Ã— 58px"})]})]}),t.thumbnail&&r.jsx("div",{className:"mt-4",children:r.jsx("img",{src:URL.createObjectURL(t.thumbnail),alt:"Thumbnail preview",className:"w-full h-auto rounded-md max-h-48 object-cover"})}),c.thumbnail&&r.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.thumbnail})]}),a>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[r.jsx("span",{children:"Uploading..."}),r.jsxs("span",{children:[a,"%"]})]}),r.jsx(m.Progress,{value:a,color:"indigo"})]}),r.jsx(m.Button,{type:"submit",color:"indigo",fullWidth:!0,disabled:O||a>0&&a<100,children:O?a>0?`Uploading (${a}%)`:"Processing...":"Upload File"})]})]})]})})};export{oe as default};
