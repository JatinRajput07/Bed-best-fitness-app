import{r as l,j as e,A as U,_ as w,u as z,z as O,D as H,a as c}from"./index-ae902f8e.js";import{P as G}from"./PencilIcon-8cc721e5.js";import{T as J}from"./TrashIcon-15502221.js";function K({title:m,titleId:u,...g},h){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:h,"aria-labelledby":u},g),m?l.createElement("title",{id:u},m):null,l.createElement("path",{fillRule:"evenodd",d:"M12.53 16.28a.75.75 0 01-1.06 0l-7.5-7.5a.75.75 0 011.06-1.06L12 14.69l6.97-6.97a.75.75 0 111.06 1.06l-7.5 7.5z",clipRule:"evenodd"}))}const V=l.forwardRef(K),W=V;function X({title:m,titleId:u,...g},h){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:h,"aria-labelledby":u},g),m?l.createElement("title",{id:u},m):null,l.createElement("path",{fillRule:"evenodd",d:"M11.47 7.72a.75.75 0 011.06 0l7.5 7.5a.75.75 0 11-1.06 1.06L12 9.31l-6.97 6.97a.75.75 0 01-1.06-1.06l7.5-7.5z",clipRule:"evenodd"}))}const Y=l.forwardRef(X),Z=Y,D=({onAddNutrition:m,users:u,loading:g,error:h,handleCancel:B,editData:t})=>{const[C,f]=l.useState((t==null?void 0:t.userId)||""),[S,k]=l.useState((t==null?void 0:t.mealTime)||""),[y,v]=l.useState((t==null?void 0:t.description)||""),[x,j]=l.useState((t==null?void 0:t.quantity)||""),[i,I]=l.useState({selectedUser:"",selectedMealTime:"",description:"",quantity:""});l.useEffect(()=>{t&&(console.log(t,"==d==d==d"),f(t.userId),k(t.mealTime),v(t.description),j(t.quantity))},[t]);const T=n=>{n.preventDefault();let p={};if(C||(p.selectedUser="User selection is required."),S||(p.selectedMealTime="Meal time selection is required."),y||(p.description="Description is required."),x||(p.quantity="Quantity is required."),I(p),Object.keys(p).length>0)return;const q={userId:C,mealTime:S,description:y,quantity:x};t!=null&&t._id?U.put(`/admin/nutrition/${t._id}`,q).then(a=>{a.data.status==="success"&&(m(a.data.data),E(),w.success("Nutrition plan updated successfully."))}).catch(a=>{var b,N;w.error(((N=(b=a==null?void 0:a.response)==null?void 0:b.data)==null?void 0:N.message)||"Failed to update nutrition plan.")}):U.post("/admin/nutrition",q).then(a=>{a.data.status==="success"&&(m(a.data.data),E(),w.success("Nutrition plan added successfully."))}).catch(a=>{var b,N;w.error(((N=(b=a==null?void 0:a.response)==null?void 0:b.data)==null?void 0:N.message)||"Failed to add nutrition plan.")})},E=()=>{f(""),k(""),v(""),j(""),I({}),B()};return e.jsxs("div",{className:"w-full p-6 border rounded-lg shadow-lg bg-white",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:t?"Edit Nutrition Plan":"Add Nutrition Plan"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"userSelect",className:"block text-sm font-medium text-gray-700",children:"Select User"}),e.jsxs("select",{disabled:!!t,id:"userSelect",className:"mt-1 h-8 px-2 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",value:C,onChange:n=>f(n.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:g?"Loading users...":"Select a user"}),h?e.jsx("option",{disabled:!0,children:"Error loading users"}):u.filter(n=>n.role==="user").map(n=>e.jsx("option",{value:n._id,children:n.name?n.name:n.email},n.id))]}),i.selectedUser&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.selectedUser})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mealTimeSelect",className:"block text-sm font-medium text-gray-700",children:"Select Nutrition Time"}),e.jsxs("select",{id:"mealTimeSelect",className:"mt-1 block px-2 h-8 w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",value:S,onChange:n=>k(n.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a meal time"}),e.jsx("option",{value:"Breakfast",children:"Breakfast"}),e.jsx("option",{value:"Lunch",children:"Lunch"}),e.jsx("option",{value:"Dinner",children:"Dinner"}),e.jsx("option",{value:"Night",children:"Night"})]}),i.selectedMealTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.selectedMealTime})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"descriptionInput",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"descriptionInput",className:"mt-1 px-2 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",value:y,onChange:n=>v(n.target.value)}),i.description&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"quantityInput",className:"block text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("input",{id:"quantityInput",className:"mt-1 px-2 h-8 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",value:x,type:"number",onChange:n=>j(n.target.value)}),i.quantity&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.quantity})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-red-500 text-white rounded-md shadow hover:bg-red-600",onClick:E,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-500 text-white rounded-md shadow hover:bg-green-600",children:t?"Update":"Submit"})]})]})]})},le=()=>{const[m,u]=l.useState([]),[g,h]=l.useState([]),[B,t]=l.useState(""),[C,f]=l.useState(!1),[S,k]=l.useState(null),[y,v]=l.useState(null),[x,j]=l.useState(null),[i,I]=l.useState(1),[T,E]=l.useState(5),{users:n,loading:p}=z(s=>s.users),[q,a]=l.useState(!1),b=O(),N=()=>{f(!1),v(null)},P=s=>{k(r=>r===s?null:s)},_=()=>{a(!0),U.get("/admin/nutrition").then(s=>{s.data.status==="success"&&(u(s.data.data),h(s.data.data))}).catch(s=>{console.error("Error fetching nutrition data:",s)}).finally(()=>{a(!1)})};l.useEffect(()=>{b(H({})),_()},[b]);const R=s=>{if(!s||typeof s!="object"||!s._id){w.error("Invalid nutrition data.");return}u(r=>y?r.map(d=>d._id===s._id?s:d):[...r,s]),h(r=>y?r.map(d=>d._id===s._id?s:d):[...r,s]),f(!1),v(null),_()},A=()=>{x&&U.delete(`/admin/nutrition/${x}`).then(s=>{s.data.status==="success"&&(u(r=>r.filter(d=>d._id!==x)),h(r=>r.filter(d=>d._id!==x)),w.success("Nutrition plan deleted successfully."))}).catch(s=>{console.error("Error deleting nutrition plan:",s),w.error("Failed to delete nutrition plan.")}).finally(()=>j(null))},L=s=>{const r=s.target.value.toLowerCase();t(r),h(m.filter(d=>{var o;return(o=d==null?void 0:d.userDetails)==null?void 0:o.name.toLowerCase().includes(r)})),I(1)},F=Math.ceil(g.length/T),$=g.slice((i-1)*T,i*T),M=s=>{s>0&&s<=F&&I(s)};return e.jsxs("div",{className:"mt-12 mb-8 flex flex-col items-center",children:[e.jsxs(c.Card,{className:"w-full max-w-6xl shadow-lg mb-6",children:[e.jsxs(c.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-red-800 to-indigo-600 p-6 rounded-t-lg flex justify-between items-center",children:[e.jsx(c.Typography,{variant:"h5",color:"white",children:"Nutrition Plans"}),e.jsx(c.Button,{color:"lightBlue",onClick:()=>f(!0),children:"Add Nutrition"})]}),C?e.jsx(D,{onAddNutrition:R,users:n,loading:p,handleCancel:N,editData:y}):e.jsxs(c.CardBody,{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx(c.Input,{type:"text",placeholder:"Search by user name",value:B,onChange:L,className:"w-1/2"})}),p||q?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"loader border-t-4 border-b-4 border-blue-500 rounded-full w-12 h-12 animate-spin"})}):$.map(s=>{var r,d;return e.jsxs("div",{className:"border-b pb-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer p-4 bg-gray-100 rounded-lg",onClick:()=>P(s.userId),children:[e.jsx(c.Typography,{variant:"h6",className:"text-gray-700",children:((r=s==null?void 0:s.userDetails)==null?void 0:r.name)||((d=s==null?void 0:s.userDetails)==null?void 0:d.email)}),S===s.userId?e.jsx(Z,{className:"h-5 w-5 text-gray-500"}):e.jsx(W,{className:"h-5 w-5 text-gray-500"})]}),S===s.userId&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"grid grid-cols-7 gap-4 text-gray-700 font-semibold bg-gray-200 p-3 rounded-t-lg",children:[e.jsx("div",{children:"Meal Time"}),e.jsx("div",{children:"Description"}),e.jsx("div",{children:"Quantity"}),e.jsx("div",{children:"Taken"}),e.jsx("div",{children:"Skipped"}),e.jsx("div",{children:"Status"}),e.jsx("div",{children:"Actions"})]}),s.nutritionDetails.map((o,Q)=>e.jsxs("div",{className:"grid grid-cols-7 gap-4 p-4 bg-white border-b last:border-none",children:[e.jsx("div",{children:o.mealTime}),e.jsx("div",{children:o.description}),e.jsx("div",{children:o.quantity}),e.jsx("div",{children:o.takenCount}),e.jsx("div",{children:o.skippedCount}),e.jsx("div",{className:o.status==="completed"?"text-green-500 font-semibold":"text-red-500 font-semibold",children:o.status}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(G,{className:"h-5 w-5 text-blue-500 cursor-pointer",onClick:()=>{v({...o,userId:s.userId}),f(!0)}}),e.jsx(J,{className:"h-5 w-5 text-red-500 cursor-pointer",onClick:()=>j(o._id)})]})]},Q))]})]},s.userId)}),F>1&&e.jsxs("div",{className:"flex justify-center items-center mt-6 space-x-4",children:[e.jsx(c.Button,{color:"gray",onClick:()=>M(i-1),disabled:i===1,children:"Previous"}),e.jsx(c.Typography,{children:`${i} / ${F}`}),e.jsx(c.Button,{color:"gray",onClick:()=>M(i+1),disabled:i===F,children:"Next"})]})]})]}),e.jsxs(c.Dialog,{open:!!x,handler:()=>j(null),children:[e.jsx(c.DialogBody,{children:e.jsx(c.Typography,{variant:"h6",className:"text-center",children:"Are you sure you want to delete this nutrition plan?"})}),e.jsxs(c.DialogFooter,{className:"flex justify-center gap-4",children:[e.jsx(c.Button,{color:"red",onClick:()=>j(null),children:"Cancel"}),e.jsx(c.Button,{color:"green",onClick:A,children:"Confirm"})]})]})]})};export{le as default};
