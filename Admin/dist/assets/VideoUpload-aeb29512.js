import{V as R,b as I,u as $,r as l,j as e,a as i,A as B,W as H,X as F,S as L,Y as O}from"./index-4e0354f5.js";import{S as E}from"./react-select.esm-ce3ab631.js";import"./assertThisInitialized-b01dd5f6.js";const Y=()=>{var w;const k=R(),p=I(),{progress:r,error:y}=$(s=>s.videos),[c,j]=l.useState(""),[N,S]=l.useState(""),[t,T]=l.useState(null),[f,x]=l.useState(),[n,m]=l.useState(null),[d,h]=l.useState(null),[o,u]=l.useState({}),[C,b]=l.useState(!1);l.useEffect(()=>{(async()=>{const a=await B.get("/admin/categories");A(a.data.data)})()},[]);const[W,A]=l.useState([]),U=s=>{const a=s.target.files[0];a&&(((t==null?void 0:t.value)==="audio"?a.type.startsWith("audio/"):(t==null?void 0:t.value)==="video"?a.type.startsWith("video/"):!0)?(m(a),u(v=>({...v,file:null}))):(m(null),u(v=>({...v,file:`Invalid file type. Please select a ${(t==null?void 0:t.value)==="audio"?"audio":"video"} file.`}))))},V=s=>{const a=s.target.files[0];a&&a.type.startsWith("image/")?(h(a),u(g=>({...g,audioThumbnail:null}))):(h(null),u(g=>({...g,audioThumbnail:"Invalid image type for audio thumbnail."})))},q=()=>{const s={};return c||(s.title="Title is required."),t||(s.category="Category is required."),n||(s.file="File is required."),(t==null?void 0:t.value)==="audio"&&!d&&(s.audioThumbnail="Audio thumbnail image is required for audio files."),u(s),Object.keys(s).length===0},D=async s=>{if(s.preventDefault(),!!q()){b(!0);try{await p(H({title:c,file:n,category:t.value,subcategories:f,description:N,audioThumbnail:d})).then(a=>{a.meta.requestStatus==="fulfilled"&&(F.showSuccessToast("File uploaded successfully!"),k("/dashboard/videos"),p(L()),j(""),S(""),T(null),x(),m(null),h(null),b(!1),p(O()))})}catch(a){console.error(a),F.showErrorToast("Failed to upload video."),b(!1)}}},P=!c||!t||!n||(t==null?void 0:t.value)==="audio"&&!d||!f||C||r>0&&r<100;return e.jsx("div",{className:"mt-12 mb-8 flex justify-center",children:e.jsxs(i.Card,{className:"w-full max-w-4 shadow-lg",children:[e.jsx(i.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-red-800  to-indigo-600 p-6 rounded-t-lg",children:e.jsx(i.Typography,{variant:"h5",color:"white",className:"text-center",children:"Upload File"})}),e.jsxs(i.CardBody,{className:"p-6 space-y-6",children:[y&&e.jsx(i.Typography,{color:"red",className:"text-sm",children:y}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsx(E,{value:t,onChange:s=>{T(s),x(),m(null),h(null)},options:W.map(s=>({value:s._id,label:s.name,type:s.type,subcategories:s.subcategories})),placeholder:"Select a category",isClearable:!0,className:"focus:ring focus:ring-indigo-500"}),o.category&&e.jsx(i.Typography,{color:"red",className:"text-sm mt-1",children:o.category})]}),t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subcategories"}),e.jsx(E,{value:f,onChange:s=>x(s),options:(w=t.subcategories)==null?void 0:w.map(s=>({value:s._id,label:s.name})),placeholder:"Select subcategories",className:"focus:ring focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:c,onChange:s=>j(s.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-indigo-500",placeholder:"Enter title"}),o.title&&e.jsx(i.Typography,{color:"red",className:"text-sm mt-1",children:o.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:N,onChange:s=>S(s.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-indigo-500",placeholder:"Enter description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"File"}),console.log(t,"====category=="),e.jsx("input",{type:"file",onChange:U,accept:(t==null?void 0:t.type)==="audio"?"audio/*":(t==null?void 0:t.type)==="image"?"image/*":"video/*",className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-indigo-500"}),o.file&&e.jsx(i.Typography,{color:"red",className:"text-sm mt-1",children:o.file})]}),(n==null?void 0:n.type.startsWith("audio"))&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1"}),e.jsx("input",{type:"file",onChange:V,accept:"image/*",className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-indigo-500"}),d&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:URL.createObjectURL(d),alt:"Audio thumbnail preview",className:"w-full h-auto rounded-md",style:{aspectRatio:"16/9",objectFit:"cover",maxHeight:"250px",maxWidth:"250px"}})}),o.audioThumbnail&&e.jsx(i.Typography,{color:"red",className:"text-sm mt-1",children:o.audioThumbnail})]}),r>0&&e.jsx("div",{children:e.jsx(i.Progress,{value:r,color:"indigo"})}),e.jsx(i.Button,{color:"indigo",fullWidth:!0,onClick:D,disabled:P,children:C?r>0?`Uploading... ${r}%`:"Please Wait...":"Upload File"})]})]})})};export{Y as default};
