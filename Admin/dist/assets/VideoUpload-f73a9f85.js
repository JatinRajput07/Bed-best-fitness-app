import{R as g,a0 as R,b as V,u as $,r as y,j as r,a as m,A as M,a1 as C,a2 as A,Y as H,a3 as G}from"./index-90b0074b.js";import{S as _}from"./react-select.esm-f4eb6ebe.js";import"./assertThisInitialized-e8b16fa2.js";var D={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},W=g.createContext&&g.createContext(D),K=["attr","size","title"];function Y(e,s){if(e==null)return{};var a=J(e,s),l,t;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(t=0;t<c.length;t++)l=c[t],!(s.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function J(e,s){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(s.indexOf(l)>=0)continue;a[l]=e[l]}return a}function j(){return j=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},j.apply(this,arguments)}function T(e,s){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);s&&(l=l.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,l)}return a}function N(e){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?T(Object(a),!0).forEach(function(l){Q(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Q(e,s,a){return s=X(s),s in e?Object.defineProperty(e,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[s]=a,e}function X(e){var s=Z(e,"string");return typeof s=="symbol"?s:s+""}function Z(e,s){if(typeof e!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,s||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(e)}function B(e){return e&&e.map((s,a)=>g.createElement(s.tag,N({key:a},s.attr),B(s.child)))}function x(e){return s=>g.createElement(ee,j({attr:N({},e.attr)},s),B(e.child))}function ee(e){var s=a=>{var{attr:l,size:t,title:c}=e,b=Y(e,K),v=t||a.size||"1em",d;return a.className&&(d=a.className),e.className&&(d=(d?d+" ":"")+e.className),g.createElement("svg",j({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,l,b,{className:d,style:N(N({color:e.color||a.color},a.style),e.style),height:v,width:v,xmlns:"http://www.w3.org/2000/svg"}),c&&g.createElement("title",null,c),e.children)};return W!==void 0?g.createElement(W.Consumer,null,a=>s(a)):s(D)}function U(e){return x({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"},child:[]},{tag:"polyline",attr:{points:"13 2 13 9 20 9"},child:[]}]})(e)}function te(e){return x({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"},child:[]},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"},child:[]},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"},child:[]},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"},child:[]},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"},child:[]},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"},child:[]},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"},child:[]},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"},child:[]}]})(e)}function re(e){return x({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},child:[]},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"},child:[]},{tag:"polyline",attr:{points:"21 15 16 10 5 21"},child:[]}]})(e)}function ae(e){return x({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 18V5l12-2v13"},child:[]},{tag:"circle",attr:{cx:"6",cy:"18",r:"3"},child:[]},{tag:"circle",attr:{cx:"18",cy:"16",r:"3"},child:[]}]})(e)}function ie(e){return x({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},child:[]},{tag:"polyline",attr:{points:"17 8 12 3 7 8"},child:[]},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"},child:[]}]})(e)}const ce=()=>{var S,E,F,L;const e=R(),s=V(),{progress:a,error:l}=$(i=>i.videos),[t,c]=y.useState({title:"",description:"",category:null,subcategories:null,file:null,thumbnail:null}),[b,v]=y.useState([]),[d,h]=y.useState({}),[O,P]=y.useState(!1);y.useEffect(()=>{(async()=>{try{const n=await M.get("/admin/categories");v(n.data.data)}catch{C.showErrorToast("Failed to load categories")}})()},[]),y.useEffect(()=>{if(t.file&&!t.title){const i=t.file.name.split(".")[0];c(n=>({...n,title:i}))}},[t.file]);const k=(i,n)=>{var f;const o=(f=i.target.files)==null?void 0:f[0];if(o){if(n==="file"&&t.category){const u=t.category.name.toLowerCase();if(u.includes("podcast")||u.includes("story")||u.includes("recognition")){if(!o.type.startsWith("audio/")&&!o.type.startsWith("video/")){h(p=>({...p,file:"Please select an audio or video file for this category"})),c(p=>({...p,[n]:null}));return}}else{const p=t.category.type;if(!o.type.startsWith(`${p}/`)){h(w=>({...w,file:`Please select a ${p} file`})),c(w=>({...w,[n]:null}));return}}}if(n==="thumbnail"&&!o.type.startsWith("image/")){h(u=>({...u,thumbnail:"Please select an image file"})),c(u=>({...u,[n]:null}));return}c(u=>({...u,[n]:o})),h(u=>({...u,[n]:void 0}))}},I=()=>{var n;const i={};return t.title||(i.title="Title is required"),t.category||(i.category="Category is required"),t.file||(i.file="File is required"),(n=t.category)!=null&&n.type&&["audio","video"].includes(t.category.type)&&!t.thumbnail&&(i.thumbnail="Thumbnail is required"),h(i),Object.keys(i).length===0},q=async i=>{var o,f;if(i.preventDefault(),!I())return;P(!0);const n=new FormData;n.append("title",t.title),n.append("description",t.description),n.append("category",(o=t.category)==null?void 0:o._id),t.subcategories?n.append("subcategories[]",t.subcategories._id):n.append("subcategories",[]),t.file&&n.append("file",t.file),(f=t.category)!=null&&f.type&&["audio","video"].includes(t.category.type)&&t.thumbnail&&n.append("thumbnail",t.thumbnail);try{(await s(A(n))).meta.requestStatus==="fulfilled"&&(C.showSuccessToast("Upload successful!"),s(H()),e("/dashboard/videos"))}catch{C.showErrorToast("Upload failed")}finally{P(!1),s(G())}},z=()=>t.file?t.file.type.startsWith("audio/")?r.jsx(ae,{className:"h-10 w-10"}):t.file.type.startsWith("video/")?r.jsx(te,{className:"h-10 w-10"}):r.jsx(U,{className:"h-10 w-10"}):r.jsx(U,{className:"h-10 w-10"});return r.jsx("div",{className:"mt-12 mb-8 flex justify-center",children:r.jsxs(m.Card,{className:"w-full max-w-4xl shadow-lg",children:[r.jsx(m.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-red-800 to-indigo-600 p-6 rounded-t-lg",children:r.jsxs(m.Typography,{variant:"h5",color:"white",className:"flex items-center gap-2",children:[r.jsx(ie,{className:"h-5 w-5"}),"Upload File"]})}),r.jsxs(m.CardBody,{className:"p-6 space-y-6",children:[l&&r.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded-md text-sm",children:l}),r.jsxs("form",{onSubmit:q,className:"space-y-6",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Category *"}),r.jsx(_,{value:t.category?{value:t.category._id,label:t.category.name}:null,onChange:i=>{const n=i?b.find(o=>o._id===i.value):null;c(o=>({...o,category:n,subcategories:null,file:null,thumbnail:null})),h(o=>({...o,category:void 0,file:void 0,thumbnail:void 0}))},options:b.map(i=>({value:i._id,label:i.name})),placeholder:"Select a category",isClearable:!0}),d.category&&r.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.category})]}),((E=(S=t.category)==null?void 0:S.subcategories)==null?void 0:E.length)>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subcategory"}),r.jsx(_,{value:t.subcategories?{value:t.subcategories._id,label:t.subcategories.name}:null,onChange:i=>{const n=i?t.category.subcategories.find(o=>o._id===i.value):null;c(o=>({...o,subcategories:n}))},options:t.category.subcategories.map(i=>({value:i._id,label:i.name})),placeholder:"Select a subcategory",isClearable:!0})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Title *"}),r.jsx(m.Input,{type:"text",value:t.title,onChange:i=>c(n=>({...n,title:i.target.value})),placeholder:"Enter title",error:!!d.title}),d.title&&r.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.title})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description ( optional )"}),r.jsx(m.Textarea,{value:t.description,onChange:i=>c(n=>({...n,description:i.target.value})),placeholder:"Enter description",rows:4})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"File *"}),r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx("input",{type:"file",onChange:i=>k(i,"file"),accept:(()=>{if(!t.category)return;const i=t.category.name.toLowerCase();return i.includes("podcast")||i.includes("story")||i.includes("recognition")?"audio/*,video/*":`${t.category.type}/*`})(),className:"hidden",id:"file-upload"}),r.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center justify-center space-y-2",children:[z(),r.jsx("p",{className:"text-sm text-gray-600",children:t.file?t.file.name:"Click to select a file"}),((F=t.category)==null?void 0:F.type)&&r.jsx("p",{className:"text-xs text-gray-500",children:(()=>{const i=t.category.name.toLowerCase();return i.includes("podcast")||i.includes("story")||i.includes("recognition")?"Audio or Video files only":`${t.category.type.toUpperCase()} files only`})()})]})]}),d.file&&r.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.file})]}),((L=t.category)==null?void 0:L.type)&&["audio","video"].includes(t.category.type)&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Thumbnail *"}),r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx("input",{type:"file",onChange:i=>k(i,"thumbnail"),accept:"image/*",className:"hidden",id:"thumbnail-upload"}),r.jsxs("label",{htmlFor:"thumbnail-upload",className:"cursor-pointer flex flex-col items-center justify-center space-y-2",children:[r.jsx(re,{className:"h-10 w-10 text-gray-400"}),r.jsx("p",{className:"text-sm text-gray-600",children:t.thumbnail?t.thumbnail.name:"Click to select a thumbnail"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Required dimensions: 77px × 58px"})]})]}),t.thumbnail&&r.jsx("div",{className:"mt-4",children:r.jsx("img",{src:URL.createObjectURL(t.thumbnail),alt:"Thumbnail preview",className:"w-full h-auto rounded-md max-h-48 object-cover"})}),d.thumbnail&&r.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.thumbnail})]}),a>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[r.jsx("span",{children:"Uploading..."}),r.jsxs("span",{children:[a,"%"]})]}),r.jsx(m.Progress,{value:a,color:"indigo"})]}),r.jsx(m.Button,{type:"submit",color:"indigo",fullWidth:!0,disabled:O||a>0&&a<100,children:O?a>0?`Uploading (${a}%)`:"Processing...":"Upload File"})]})]})]})})};export{ce as default};
