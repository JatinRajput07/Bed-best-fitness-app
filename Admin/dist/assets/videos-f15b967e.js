import{r as t,z as O,u as L,o as D,j as e,a as r,F as h,G as U,D as P,A}from"./index-4de74d33.js";import{T as F}from"./TrashIcon-fedc842c.js";function $({title:n,titleId:c,...d},i){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true",ref:i,"aria-labelledby":c},d),n?t.createElement("title",{id:c},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"}))}const M=t.forwardRef($),H=M;function I({title:n,titleId:c,...d},i){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true",ref:i,"aria-labelledby":c},d),n?t.createElement("title",{id:c},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"}))}const z=t.forwardRef(I),G=z,Q=({category_name:n,onGoBack:c})=>{const d=O(),[i,j]=t.useState({}),[u,g]=t.useState("All"),[x,p]=t.useState([]),[v,m]=t.useState(!1),[y,w]=t.useState(null),[f,b]=t.useState([]),{users:N,loading:C,error:R}=L(o=>o.users);t.useEffect(()=>{D.get(`http://43.204.2.84:7200/admin/video-list-byCategory/${n}`).then(o=>{o.data.status==="success"&&j(o.data.data)}).catch(o=>{console.error("Error fetching video data:",o)})},[n]),t.useEffect(()=>{if(u==="All")p(Object.values(i).flat());else{const o=i[u]||[];p(o)}},[u,i]),[...new Set(Object.keys(i))];const k=o=>{const s=o.split(".").pop().toLowerCase();return s==="mp4"?e.jsx("video",{className:"w-full h-48 object-cover rounded-t-lg",src:o,type:"video/mp4",controls:!0,children:"Your browser does not support the video tag."}):s==="mp3"||s==="wav"?e.jsxs("audio",{className:"w-full h-48 object-cover rounded-t-lg",controls:!0,children:[e.jsx("source",{src:o,type:`audio/${s}`}),"Your browser does not support the audio element."]}):s==="jpg"||s==="jpeg"||s==="png"||s==="gif"?e.jsx("img",{className:"w-full h-48 object-cover rounded-t-lg",src:o,alt:"media preview"}):null},V=o=>{D.delete(`http://43.204.2.84:7200/admin/video-list/${o}`).then(()=>{h.success("Video deleted successfully!"),d(U()),j(s=>{const a={...s};return Object.keys(a).forEach(l=>{a[l]=a[l].filter(_=>_._id!==o)}),a})}).catch(s=>console.log(s,"d=f=ff=ff=fff"))},E=()=>{const o=f.map(s=>D.post("http://43.204.2.84:7200/api/recommendation",{videoId:y,userId:s}));Promise.all(o).then(()=>{h.success("Video recommended successfully!"),m(!1),b([])}).catch(()=>h.error("Error recommending video."))},S=o=>{b(s=>s.includes(o)?s.filter(a=>a!==o):[...s,o])},T=()=>N.filter(o=>o.role==="user").map(o=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r.Checkbox,{checked:f.includes(o._id),onChange:()=>S(o._id)}),e.jsx(r.Typography,{variant:"small",color:"blue-gray",children:o.name})]},o._id)),B=o=>["workout-video","recipe-video","knowledge-video","story-podcast-recognition-video"].includes(o);return e.jsxs("div",{className:"mt-12 mb-8 flex flex-col gap-12",children:[e.jsxs(r.Card,{children:[e.jsxs(r.CardHeader,{variant:"gradient",color:"gray",className:"mb-8 p-6 relative flex items-center justify-center",children:[e.jsx(H,{onClick:c,className:"absolute left-4 h-6 w-6 text-white cursor-pointer"}),e.jsx(r.Typography,{variant:"h6",color:"white",className:"text-center",children:n.replace(/-/g," ").toUpperCase()})]}),e.jsx(r.CardBody,{className:"p-4",children:x.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-12 md:grid-cols-2 xl:grid-cols-4",children:x.map(o=>e.jsxs(r.Card,{className:"shadow-lg rounded-lg",children:[e.jsx(r.CardHeader,{floated:!1,color:"gray",className:"mx-0 mt-0 mb-4 h-48 xl:h-40",children:k(o.path)}),e.jsxs(r.CardBody,{className:"p-4 bg-white",children:[e.jsx(r.Typography,{variant:"h6",className:"text-sm mb-2 font-semibold",children:o.title}),o.subcategories&&e.jsx(r.Typography,{variant:"small",className:"text-gray-600",children:o.subcategories.join(", ")}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx(r.IconButton,{style:{height:"25px",width:"25px"},color:"red",onClick:()=>V(o.id),children:e.jsx(F,{className:"h-4 w-4"})}),B(n)&&e.jsx(r.IconButton,{color:"yellow",onClick:()=>{w(o._id),m(!0)},children:e.jsx(G,{className:"h-5 w-5"})})]})]})]},o._id||o.title))}):e.jsx(r.Typography,{variant:"small",color:"gray",className:"text-center mt-4",children:"No data found for this subcategory."})})]}),e.jsxs(r.Dialog,{open:v,handler:()=>m(!1),children:[e.jsxs(r.DialogBody,{className:"max-h-96 overflow-y-auto",children:[e.jsx(r.Typography,{variant:"h6",className:"mb-4",children:"Recommend Video to Users"}),T()]}),e.jsxs(r.DialogFooter,{children:[e.jsx(r.Button,{variant:"text",color:"red",onClick:()=>m(!1),children:"Cancel"}),e.jsx(r.Button,{color:"blue",onClick:E,children:"Recommend"})]})]})]})};function q(){const n=O(),[c,d]=t.useState(null),[i,j]=t.useState(null),[u,g]=t.useState(!1),[x,p]=t.useState([]),[v,m]=t.useState(""),{videos:y,loading:w,error:f}=L(s=>s.videos),{users:b,loading:N,error:C}=L(s=>s.users);if(t.useEffect(()=>{n(U()),n(P({}))},[n]),w||N)return e.jsx("div",{children:"Loading..."});if(f||C)return e.jsxs("div",{children:["Error: ",f||C]});const R=s=>{A.delete(`/admin/video-list/${s}`).then(()=>{h.success("Video deleted successfully!"),n(U())}).catch(()=>h.error("Error deleting video."))},k=()=>{const s=x.map(a=>A.post("/api/recommendation",{videoId:i,userId:a}));Promise.all(s).then(()=>{h.success("Video recommended successfully!"),g(!1),p([])}).catch(()=>h.error("Error recommending video."))},V=s=>{p(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s])},E=()=>b.filter(s=>s.role==="user"&&s.name.toLowerCase().includes(v.toLowerCase())).map(s=>e.jsxs("div",{className:"flex items-center gap-4 py-2",children:[e.jsx(r.Checkbox,{checked:x.includes(s._id),onChange:()=>V(s._id)}),e.jsx(r.Typography,{variant:"small",color:"blue-gray",children:s.name?s.name:s.email})]},s._id)),S=s=>{const{filetype:a,path:l}=s;switch(a){case"video":return e.jsx("video",{src:l,controls:!0,className:"w-full h-48 object-cover rounded-t-lg"});case"audio":return e.jsx("audio",{controls:!0,className:"w-full h-48 object-cover rounded-t-lg",children:e.jsx("source",{src:l})});case"image":return e.jsx("img",{src:l,alt:"media",className:"w-full h-48 object-cover rounded-t-lg"});case"pdf":return e.jsx("a",{href:l,target:"_blank",rel:"noopener noreferrer",className:"block w-full h-48 flex items-center justify-center bg-gray-200 rounded-t-lg",children:e.jsx(r.Typography,{variant:"small",color:"blue",children:"View PDF"})});default:return e.jsx("div",{className:"w-full h-48 flex items-center justify-center bg-gray-200 rounded-t-lg",children:e.jsx(r.Typography,{variant:"small",color:"red",children:"Unsupported file type"})})}},T=s=>d(s),B=s=>["workout-video","recipe-video","knowledge-video","story-podcast-recognition-video"].includes(s),o=()=>d(null);return e.jsxs("div",{className:"mt-12 mb-8 flex flex-col gap-12",children:[c?e.jsx(Q,{category_name:c,onGoBack:o}):e.jsxs(r.Card,{children:[e.jsx(r.CardHeader,{variant:"gradient",color:"gray",className:"mb-8 p-6",children:e.jsx(r.Typography,{variant:"h6",color:"white",children:"Videos And Other Files"})}),e.jsx(r.CardBody,{className:"p-4",children:Object.keys(y).map(s=>{const a=y[s];return e.jsxs("div",{className:"px-4 mt-8 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(r.Typography,{variant:"h6",color:"blue-gray",children:s.replace(/-/g," ").toUpperCase()}),e.jsx(r.Button,{size:"sm",variant:"text",color:"blue",onClick:()=>T(s),children:"View All"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-8 mt-6 md:grid-cols-2 xl:grid-cols-4",children:a.map(l=>e.jsxs(r.Card,{className:"shadow-lg rounded-lg",children:[e.jsx(r.CardHeader,{floated:!1,className:"mx-0 mt-0 mb-4 h-48",children:S(l)}),e.jsxs(r.CardBody,{children:[e.jsx(r.Typography,{variant:"h6",className:"text-sm mb-1",children:l.title}),e.jsx(r.Typography,{variant:"small",color:"gray",className:"mb-2",children:l.description||"No description available."}),e.jsxs("div",{className:"flex justify-between items-center",children:[B(s)&&e.jsx("button",{onClick:()=>{j(l==null?void 0:l.id),g(!0)},className:"bg-pink-500 text-white active:bg-pink-600 font-bold uppercase text-xs px-4 py-2 rounded shadow hover:shadow-md outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150",type:"button",children:"Assign to User"}),e.jsx(r.IconButton,{style:{height:"25px",width:"25px"},color:"red",onClick:()=>R(l.id),children:e.jsx(F,{className:"h-4 w-4"})})]})]})]},l._id))})]},s)})})]}),e.jsxs(r.Dialog,{open:u,handler:()=>g(!1),children:[e.jsxs(r.DialogBody,{className:"max-h-96 overflow-y-auto",children:[e.jsx(r.Typography,{variant:"h6",className:"mb-4",children:"Recommend Video to Users"}),e.jsx(r.Input,{label:"Search Users",value:v,onChange:s=>m(s.target.value),className:"mb-4 w-full"}),E()]}),e.jsxs(r.DialogFooter,{children:[e.jsx(r.Button,{variant:"text",color:"red",onClick:()=>g(!1),children:"Cancel"}),e.jsx(r.Button,{variant:"gradient",color:"green",onClick:k,children:"Recommend"})]})]})]})}export{q as Videos,q as default};
