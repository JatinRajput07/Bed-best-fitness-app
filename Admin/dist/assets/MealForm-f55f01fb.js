import{r,u as Y,b as Z,J as K,A as i,j as e,a,_ as d}from"./index-4d29aa5c.js";import{P as ee}from"./PencilIcon-3e7b5421.js";import{T as P}from"./TrashIcon-69dd6333.js";const ne=()=>{const[T,N]=r.useState(!1),[h,m]=r.useState(""),[u,g]=r.useState(""),[x,p]=r.useState(""),[f,R]=r.useState([]),[v,D]=r.useState([]),[n,C]=r.useState(null),[L,z]=r.useState({}),[j,F]=r.useState(""),[k,S]=r.useState(1),[y,te]=r.useState(5),[U,w]=r.useState(!1),[E,M]=r.useState(null),H=t=>{M(t),w(!0)},b=()=>{w(!1),M(null)},{users:Q,loading:I,error:ae}=Y(t=>t.users),B=Z();r.useEffect(()=>{B(K({}))},[B]),r.useEffect(()=>{c()},[]),r.useEffect(()=>{W(j)},[f,j]);const c=()=>{i.get("/admin/meal").then(t=>{t.data.status==="success"&&R(t.data.data)}).catch(t=>{console.error("Error fetching meal data:",t)})},W=t=>{if(!t)D(f);else{const s=f.filter(l=>l.name.toLowerCase().includes(t.toLowerCase()));D(s),S(1)}},$=t=>{S(t)};function J(t){return{wake_up_food:"Early Morning (Wake-up Meal)",breakfast:"Breakfast (Power Breakfast)",morning_snacks:"Mid-Morning Snack (Energy Bites)",lunch:"Lunch (Fuel Plate)",evening_snacks:"Evening Snack (Refresh & Recharge)",dinner:"Dinner (Light & Right)"}[t]||t.trim().replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())}const _=()=>N(!0),o=()=>{m(""),g(""),p(""),N(!1),C(null)},q=async()=>{if(!h||!u||!x)return;const t={category:h,item:u,userId:x};n?i.put(`/admin/meal/${n.itemId}`,t).then(s=>{s.data.status==="success"&&(c(),o())}).catch(s=>{console.error("Error updating meal:",s),d.error("Error updating meal.")}):i.post("/admin/meal",t).then(s=>{s.data.status==="success"&&(c(),o())}).catch(s=>{console.error("Error submitting meal:",s),d.error("Error adding meal.")})},G=()=>{E&&i.delete(`/admin/meal/${E}`).then(t=>{t.data.status==="success"&&(c(),d.success("Meal deleted successfully."))}).catch(t=>{console.error("Error deleting meal:",t),d.error("Error deleting meal.")}).finally(()=>{b()})},V=t=>{z(s=>({...s,[t]:!s[t]}))},A=(k-1)*y,O=v.slice(A,A+y),X=Math.ceil(v.length/y);return e.jsxs("div",{className:"mt-12 mb-8 flex justify-center",children:[e.jsxs(a.Card,{className:"w-full max-w-6xl shadow-lg",children:[e.jsxs(a.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-red-800 to-indigo-600 p-6 rounded-t-lg flex justify-between items-center",children:[e.jsx(a.Typography,{variant:"h5",color:"white",children:"Meal"}),e.jsx(a.Button,{color:"lightBlue",onClick:_,children:"Add Meal"})]}),e.jsx("div",{className:"flex justify-between items-center mb-4 mt-3 px-4",children:e.jsx(a.Input,{placeholder:"Search by user name...",value:j,onChange:t=>F(t.target.value),className:"w-1/2"})}),e.jsx(a.CardBody,{className:"p-6 space-y-6",children:I?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"loader border-t-4 border-b-4 border-blue-500 rounded-full w-12 h-12 animate-spin"})}):O.length>0?O.map(t=>e.jsxs(a.Accordion,{open:L[t.userId],children:[e.jsx(a.AccordionHeader,{onClick:()=>V(t.userId),children:e.jsx(a.Typography,{variant:"h6",color:"gray-700",children:t.name})}),e.jsx(a.AccordionBody,{children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"px-6 py-2 text-left text-sm font-medium text-gray-700",children:"Category"}),e.jsx("th",{className:"px-6 py-2 text-left text-sm font-medium text-gray-700",children:"Item"}),e.jsx("th",{className:"px-6 py-2 text-left text-sm font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:Object.keys(t.meals).map(s=>t.meals[s].map(l=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-2 text-sm text-gray-600",children:J(s)}),e.jsx("td",{className:"px-6 py-2 text-sm text-gray-600",children:l.itemName}),e.jsxs("td",{className:"px-6 py-2 text-sm text-gray-600 flex space-x-2",children:[e.jsx(ee,{className:"h-5 w-5 text-blue-500 cursor-pointer",onClick:()=>{m(s),g(l.itemName),p(t.userId),C(l),_()}}),e.jsx(P,{className:"h-5 w-5 text-red-500 cursor-pointer",onClick:()=>H(l.itemId)})]})]},l.itemId)))})]})})]},t.userId)):e.jsx(a.Typography,{children:"No meals found."})}),e.jsx("div",{className:"flex justify-center items-center gap-4 mt-4",children:Array.from({length:X}).map((t,s)=>e.jsx(a.Button,{onClick:()=>$(s+1),variant:k===s+1?"gradient":"text",children:s+1},s+1))})]}),e.jsxs(a.Dialog,{open:T,handler:o,size:"lg",children:[e.jsx(a.DialogBody,{children:e.jsxs("div",{className:"space-y-6 p-6 bg-gray-50 rounded-lg",children:[e.jsx(a.Typography,{className:"text-lg font-semibold text-gray-800",children:"Add or Edit Meal"}),e.jsxs("select",{disabled:!!n,className:"bg-gray-100 border-2 h-10 rounded-[7px] w-full",onChange:t=>p(t.target.value),value:x,children:[e.jsx("option",{children:"Select User"}),Q.filter(t=>t.role==="user").map(t=>e.jsx("option",{value:t._id,children:t.name?t.name:t.email},t._id))]}),e.jsxs(a.Select,{disabled:!!n,label:"Select Category",onChange:m,value:h,children:[e.jsx(a.Option,{value:"wake_up_food",children:"Early Morning (Wake-up Meal)"}),e.jsx(a.Option,{value:"breakfast",children:"Breakfast (Power Breakfast)"}),e.jsx(a.Option,{value:"morning_snacks",children:"Mid-Morning Snack (Energy Bites)"}),e.jsx(a.Option,{value:"lunch",children:"Lunch (Fuel Plate)"}),e.jsx(a.Option,{value:"evening_snacks",children:"Evening Snack (Refresh & Recharge)"}),e.jsx(a.Option,{value:"dinner",children:"Dinner (Light & Right)"})]}),e.jsx(a.Input,{label:"Meal Item",value:u,onChange:t=>g(t.target.value),required:!0,className:"text-lg"})]})}),e.jsxs(a.DialogFooter,{children:[e.jsx(a.Button,{color:"red",onClick:o,children:"Cancel"}),e.jsx(a.Button,{color:"green",onClick:q,children:I?e.jsx(a.CircularProgress,{size:24}):"Submit"})]})]}),e.jsxs(a.Dialog,{open:U,handler:b,size:"sm",children:[e.jsx(a.DialogHeader,{className:"bg-gray-100 text-center py-4",children:e.jsx(a.Typography,{variant:"h5",color:"blue-gray",className:"font-semibold",children:"Confirm Deletion"})}),e.jsxs(a.DialogBody,{className:"flex flex-col items-center gap-6 p-6",children:[e.jsx("div",{className:"p-4 rounded-full bg-red-100 flex justify-center items-center",children:e.jsx(P,{className:"h-10 w-10 text-red-500"})}),e.jsx(a.Typography,{className:"text-center text-base font-medium text-blue-gray-600",children:"Are you sure you want to delete this meal? This action cannot be undone."})]}),e.jsxs(a.DialogFooter,{className:"bg-gray-50 flex justify-center gap-4 py-4",children:[e.jsx(a.Button,{variant:"outlined",color:"blue-gray",className:"w-24",onClick:b,children:"Cancel"}),e.jsx(a.Button,{variant:"gradient",color:"red",className:"w-24",onClick:G,children:"Delete"})]})]})]})};export{ne as default};
