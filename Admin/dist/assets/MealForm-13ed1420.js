import{r,u as R,z as W,D as q,A as i,j as e,a as s,_ as d}from"./index-a6ad2ded.js";import{P as G}from"./PencilIcon-9452a2d6.js";import{T as J}from"./TrashIcon-3a6fe0fc.js";const ee=()=>{const[O,b]=r.useState(!1),[m,h]=r.useState(""),[u,x]=r.useState(""),[g,p]=r.useState(""),[f,_]=r.useState([]),[N,v]=r.useState([]),[l,C]=r.useState(null),[B,M]=r.useState({}),[j,P]=r.useState(""),[S,D]=r.useState(1),[y,V]=r.useState(5),{users:T,loading:I,error:X}=R(t=>t.users),k=W();r.useEffect(()=>{k(q({}))},[k]),r.useEffect(()=>{c()},[]),r.useEffect(()=>{U(j)},[f,j]);const c=()=>{i.get("/admin/meal").then(t=>{t.data.status==="success"&&_(t.data.data)}).catch(t=>{console.error("Error fetching meal data:",t)})},U=t=>{if(!t)v(f);else{const a=f.filter(n=>n.name.toLowerCase().includes(t.toLowerCase()));v(a),D(1)}},z=t=>{D(t)};function F(t){return t.trim().replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}const w=()=>b(!0),o=()=>{h(""),x(""),p(""),b(!1),C(null)},L=async()=>{if(!m||!u||!g)return;const t={category:m,item:u,userId:g};l?i.put(`/admin/meal/${l.itemId}`,t).then(a=>{a.data.status==="success"&&(c(),o())}).catch(a=>{console.error("Error updating meal:",a),d.error("Error updating meal.")}):i.post("/admin/meal",t).then(a=>{a.data.status==="success"&&(c(),o())}).catch(a=>{console.error("Error submitting meal:",a),d.error("Error adding meal.")})},H=t=>{i.delete(`/admin/meal/${t}`).then(a=>{a.data.status==="success"&&(c(),d.success("Meal deleted successfully."))}).catch(a=>{console.error("Error deleting meal:",a),d.error("Error deleting meal.")})},Q=t=>{M(a=>({...a,[t]:!a[t]}))},E=(S-1)*y,A=N.slice(E,E+y),$=Math.ceil(N.length/y);return e.jsxs("div",{className:"mt-12 mb-8 flex justify-center",children:[e.jsxs(s.Card,{className:"w-full max-w-6xl shadow-lg",children:[e.jsxs(s.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-red-800 to-indigo-600 p-6 rounded-t-lg flex justify-between items-center",children:[e.jsx(s.Typography,{variant:"h5",color:"white",children:"Meal"}),e.jsx(s.Button,{color:"lightBlue",onClick:w,children:"Add Meal"})]}),e.jsx("div",{className:"flex justify-between items-center mb-4 mt-3 px-4",children:e.jsx(s.Input,{placeholder:"Search by user name...",value:j,onChange:t=>P(t.target.value),className:"w-1/2"})}),e.jsx(s.CardBody,{className:"p-6 space-y-6",children:I?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"loader border-t-4 border-b-4 border-blue-500 rounded-full w-12 h-12 animate-spin"})}):A.length>0?A.map(t=>e.jsxs(s.Accordion,{open:B[t.userId],children:[e.jsx(s.AccordionHeader,{onClick:()=>Q(t.userId),children:e.jsx(s.Typography,{variant:"h6",color:"gray-700",children:t.name})}),e.jsx(s.AccordionBody,{children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"px-6 py-2 text-left text-sm font-medium text-gray-700",children:"Category"}),e.jsx("th",{className:"px-6 py-2 text-left text-sm font-medium text-gray-700",children:"Item"}),e.jsx("th",{className:"px-6 py-2 text-left text-sm font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:Object.keys(t.meals).map(a=>t.meals[a].map(n=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-2 text-sm text-gray-600",children:F(a)}),e.jsx("td",{className:"px-6 py-2 text-sm text-gray-600",children:n.itemName}),e.jsxs("td",{className:"px-6 py-2 text-sm text-gray-600 flex space-x-2",children:[e.jsx(G,{className:"h-5 w-5 text-blue-500 cursor-pointer",onClick:()=>{h(a),x(n.itemName),p(t.userId),C(n),w()}}),e.jsx(J,{className:"h-5 w-5 text-red-500 cursor-pointer",onClick:()=>H(n.itemId)})]})]},n.itemId)))})]})})]},t.userId)):e.jsx(s.Typography,{children:"No meals found."})}),e.jsx("div",{className:"flex justify-center items-center gap-4 mt-4",children:Array.from({length:$}).map((t,a)=>e.jsx(s.Button,{onClick:()=>z(a+1),variant:S===a+1?"gradient":"text",children:a+1},a+1))})]}),e.jsxs(s.Dialog,{open:O,handler:o,size:"lg",children:[e.jsx(s.DialogBody,{children:e.jsxs("div",{className:"space-y-6 p-6 bg-gray-50 rounded-lg",children:[e.jsx(s.Typography,{className:"text-lg font-semibold text-gray-800",children:"Add or Edit Meal"}),e.jsxs("select",{disabled:!!l,className:"bg-gray-100 border-2 h-10 rounded-[7px] w-full",onChange:t=>p(t.target.value),value:g,children:[e.jsx("option",{children:"Select User"}),T.filter(t=>t.role==="user").map(t=>e.jsx("option",{value:t._id,children:t.name?t.name:t.email},t._id))]}),e.jsxs(s.Select,{disabled:!!l,label:"Select Category",onChange:h,value:m,children:[e.jsx(s.Option,{value:"breakfast",children:"Breakfast"}),e.jsx(s.Option,{value:"dinner",children:"Dinner"}),e.jsx(s.Option,{value:"evening_snacks",children:"Evening Snacks"}),e.jsx(s.Option,{value:"lunch",children:"Lunch"}),e.jsx(s.Option,{value:"morning_snacks",children:"Morning Snacks"}),e.jsx(s.Option,{value:"wake_up_food",children:"Wake Up Food"})]}),e.jsx(s.Input,{label:"Meal Item",value:u,onChange:t=>x(t.target.value),required:!0,className:"text-lg"})]})}),e.jsxs(s.DialogFooter,{children:[e.jsx(s.Button,{color:"red",onClick:o,children:"Cancel"}),e.jsx(s.Button,{color:"green",onClick:L,children:I?e.jsx(s.CircularProgress,{size:24}):"Submit"})]})]})]})};export{ee as default};
