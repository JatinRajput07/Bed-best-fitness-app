import{r as m,j as e,a as t,A as U,_ as S,u as G,b as K,J as V}from"./index-4d29aa5c.js";import{P as W}from"./PencilIcon-3e7b5421.js";import{T as z}from"./TrashIcon-69dd6333.js";const X=({onAddNutrition:P,users:I,loading:B,handleCancel:f,editData:i})=>{const[k,_]=m.useState((i==null?void 0:i.userId)||""),[w,h]=m.useState((i==null?void 0:i.description)||""),[x,g]=m.useState({name:(i==null?void 0:i.name)||"",totalQuantity:(i==null?void 0:i.totalQuantity)||20}),[u,p]=m.useState({}),b=["Pre Breakfast","Post Breakfast","Pre Lunch","Post Lunch","Pre Dinner","Post Dinner","Before Sleep at Night","In Every 2-3 hours"],y=()=>{_(""),h(""),g({name:"",totalQuantity:20}),p({})},Q=r=>{r.preventDefault();let d={};if(k||(d.selectedUser="User selection is required."),x.name.trim()||(d.itemName="Item name is required."),x.totalQuantity<=0&&(d.totalQuantity="Quantity must be positive."),p(d),Object.keys(d).length>0)return;const E={userId:k,description:w,name:x.name.trim(),totalQuantity:x.totalQuantity,categories:b.map(o=>({name:o,consumed:0,remaining:x.totalQuantity}))};i!=null&&i._id?U.put(`/admin/nutrition/${i._id}`,E).then(o=>{o.data.status==="success"&&(P(o.data.data),y(),S.success("Nutrition plan updated successfully."))}).catch(o=>{var j,N;S.error(((N=(j=o==null?void 0:o.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to update nutrition plan.")}):U.post("/admin/nutrition",E).then(o=>{o.data.status==="success"&&(P(o.data.data),y(),S.success("Nutrition plan added successfully."))}).catch(o=>{var j,N;S.error(((N=(j=o==null?void 0:o.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to add nutrition plan.")})};return e.jsxs(t.Dialog,{open:!0,size:"lg",handler:f,dismiss:{enabled:!1},children:[e.jsx(t.DialogHeader,{children:i?"Edit Nutrition Plan":"Add Nutrition Plan"}),e.jsx(t.DialogBody,{children:e.jsx("form",{onSubmit:Q,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx(t.Select,{label:"Select User",value:k,onChange:r=>{_(r),p(d=>({...d,selectedUser:!1}))},error:!!u.selectedUser,children:I.map(r=>e.jsx(t.Option,{value:r._id,children:r.name},r._id))}),u.selectedUser&&e.jsx(t.Typography,{variant:"small",color:"red",className:"mt-1",children:u.selectedUser})]})}),e.jsx("div",{children:e.jsx(t.Textarea,{label:"Description",value:w,onChange:r=>h(r.target.value)})}),e.jsxs("div",{children:[e.jsx(t.Typography,{variant:"h6",children:"Nutrition Item"}),e.jsxs("div",{className:"flex flex-col gap-4 mt-2",children:[e.jsx(t.Input,{placeholder:"Item Name (e.g., Omega 3 Tablet)",value:x.name,onChange:r=>{g(d=>({...d,name:r.target.value})),p(d=>({...d,itemName:!1}))},error:!!u.itemName}),u.itemName&&e.jsx(t.Typography,{variant:"small",color:"red",className:"mt-1",children:u.itemName}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(t.Typography,{children:"Total Quantity:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(t.Button,{variant:"text",onClick:()=>g(r=>({...r,totalQuantity:Math.max(1,r.totalQuantity-1)})),children:"-"}),e.jsx(t.Input,{type:"number",value:x.totalQuantity,onChange:r=>g(d=>({...d,totalQuantity:parseInt(r.target.value)||0})),className:"w-20 text-center"}),e.jsx(t.Button,{variant:"text",onClick:()=>g(r=>({...r,totalQuantity:r.totalQuantity+1})),children:"+"})]})]}),u.totalQuantity&&e.jsx(t.Typography,{variant:"small",color:"red",className:"mt-1",children:u.totalQuantity})]})]}),e.jsxs("div",{children:[e.jsx(t.Typography,{variant:"h6",className:"mb-2",children:"Tracking Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map((r,d)=>e.jsx(t.Chip,{value:r,className:"cursor-default"},d))}),e.jsx(t.Typography,{variant:"small",className:"mt-2 text-gray-600",children:"These categories will be used to track consumption of this item."})]})]})})}),e.jsxs(t.DialogFooter,{children:[e.jsx(t.Button,{variant:"text",onClick:f,className:"mr-2",children:"Cancel"}),e.jsx(t.Button,{color:"blue",onClick:Q,disabled:B,children:i?"Update":"Submit"})]})]})},te=()=>{var H;const[P,I]=m.useState([]),[B,f]=m.useState([]),[i,k]=m.useState(""),[_,w]=m.useState(!1),[h,x]=m.useState(null),[g,u]=m.useState(null),[p,b]=m.useState(null),[y,Q]=m.useState(1),[r,d]=m.useState(5),{users:E,loading:o}=G(s=>s.users),[j,N]=m.useState(!1),A=K(),O=()=>{w(!1),u(null)},L=()=>{N(!0),U.get("/admin/nutrition").then(s=>{if(s.data.status==="success"){const n=s.data.data.sort((l,a)=>{var c,v,C,T;return(((c=l==null?void 0:l.userDetails)==null?void 0:c.name)||((v=l==null?void 0:l.userDetails)==null?void 0:v.email)).localeCompare(((C=a==null?void 0:a.userDetails)==null?void 0:C.name)||((T=a==null?void 0:a.userDetails)==null?void 0:T.email))});I(n),f(n),n.length>0&&x(n[0])}else I([]),f([])}).catch(s=>{console.error("Error fetching nutrition data:",s),S.error("Failed to fetch nutrition data.")}).finally(()=>{N(!1)})};m.useEffect(()=>{A(V({})),L()},[A]);const M=s=>{if(!s||typeof s!="object"||!s._id){S.error("Invalid nutrition data.");return}I(n=>(g?n.map(a=>a._id===s._id?s:a):[...n,s]).sort((a,c)=>{var v,C,T,D;return(((v=a==null?void 0:a.userDetails)==null?void 0:v.name)||((C=a==null?void 0:a.userDetails)==null?void 0:C.email)||"").localeCompare(((T=c==null?void 0:c.userDetails)==null?void 0:T.name)||((D=c==null?void 0:c.userDetails)==null?void 0:D.email))})),f(n=>(g?n.map(a=>a._id===s._id?s:a):[...n,s]).sort((a,c)=>{var v,C,T,D;return(((v=a==null?void 0:a.userDetails)==null?void 0:v.name)||((C=a==null?void 0:a.userDetails)==null?void 0:C.email)||"").localeCompare(((T=c==null?void 0:c.userDetails)==null?void 0:T.name)||((D=c==null?void 0:c.userDetails)==null?void 0:D.email))})),w(!1),u(null),L()},R=()=>{p&&U.delete(`/admin/nutrition/${p}`).then(s=>{s.data.status==="success"&&(I(n=>n.filter(l=>l._id!==p)),f(n=>n.filter(l=>l._id!==p)),S.success("Nutrition plan deleted successfully."))}).catch(s=>{console.error("Error deleting nutrition plan:",s),S.error("Failed to delete nutrition plan.")}).finally(()=>b(null))},J=s=>{const n=s.target.value.toLowerCase();k(n),f(P.filter(l=>{var a,c;return(((a=l==null?void 0:l.userDetails)==null?void 0:a.name)||((c=l==null?void 0:l.userDetails)==null?void 0:c.email)).toLowerCase().includes(n)})),Q(1)},F=Math.ceil(B.length/r),$=B.slice((y-1)*r,y*r),q=s=>{s>0&&s<=F&&Q(s)};return e.jsxs("div",{className:"mt-12 mb-8 flex flex-col items-center",children:[e.jsxs(t.Card,{className:"w-full max-w-6xl shadow-lg mb-6",children:[e.jsxs(t.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-red-800 to-indigo-600 p-6 rounded-t-lg flex justify-between items-center",children:[e.jsx(t.Typography,{variant:"h5",color:"white",children:"Nutrition Plans"}),e.jsx(t.Button,{color:"lightBlue",onClick:()=>w(!0),children:"Add Nutrition"})]}),_?e.jsx(X,{onAddNutrition:M,users:E,loading:o,handleCancel:O,editData:g}):e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"w-full md:w-1/4 border-r p-4",children:[e.jsx("div",{className:"mb-6",children:e.jsx(t.Input,{type:"text",placeholder:"Search by user name",value:i,onChange:J,className:"mb-4"})}),j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(t.Typography,{variant:"small",className:"text-gray-600",children:"Please wait..."})}):$.length>0?$.map((s,n)=>{var l,a;return e.jsx("div",{className:`p-3 cursor-pointer rounded-lg mb-2 ${(h==null?void 0:h.userId)===s.userId?"bg-blue-100":"hover:bg-gray-100"}`,onClick:()=>x(s),children:e.jsxs(t.Typography,{variant:"small",className:"font-semibold",children:[n+1,". ",((l=s==null?void 0:s.userDetails)==null?void 0:l.name)||((a=s==null?void 0:s.userDetails)==null?void 0:a.email)]})},s.userId)}):e.jsx(t.Typography,{variant:"small",className:"text-gray-600 text-center",children:"No data found."}),F>1&&e.jsxs("div",{className:"flex justify-center items-center mt-6 space-x-4",children:[e.jsx(t.Button,{color:"gray",onClick:()=>q(y-1),disabled:y===1,children:"Previous"}),e.jsx(t.Typography,{children:`${y} / ${F}`}),e.jsx(t.Button,{color:"gray",onClick:()=>q(y+1),disabled:y===F,children:"Next"})]})]}),e.jsx("div",{className:"w-full md:w-3/4 p-4",children:j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(t.Typography,{variant:"small",className:"text-gray-600",children:"Please wait..."})}):h?e.jsx("div",{children:(H=h==null?void 0:h.mealTimeGroups)==null?void 0:H.map((s,n)=>e.jsxs(t.Card,{className:"mt-6 mb-6 shadow-sm",children:[e.jsx(t.CardHeader,{className:"bg-gray-100 p-4",children:e.jsx(t.Typography,{variant:"h6",className:"text-gray-700",children:s.mealTime})}),e.jsx(t.CardBody,{className:"p-4",children:s.nutritionDetails.map((l,a)=>e.jsx("div",{className:"border-b last:border-none py-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[e.jsxs("div",{className:"w-96 mb-2 md:mb-0",children:[e.jsx(t.Typography,{variant:"small",className:"font-semibold",children:l.name}),e.jsx(t.Typography,{variant:"small",className:"text-gray-600",children:l.description})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center space-y-2 md:space-y-0 md:space-x-4",children:[e.jsxs(t.Typography,{variant:"small",children:["Quantity: ",l.quantity]}),e.jsxs(t.Typography,{variant:"small",children:["Taken: ",l.takenCount]}),e.jsxs(t.Typography,{variant:"small",children:["Skipped: ",l.skippedCount]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-sm font-semibold ${l.status==="completed"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:l.status}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(W,{className:"h-5 w-5 text-blue-500 cursor-pointer",onClick:()=>{u({...l,userId:h.userId}),w(!0)}}),e.jsx(z,{className:"h-5 w-5 text-red-500 cursor-pointer",onClick:()=>b(l._id)})]})]})]})},a))})]},n))}):e.jsx(t.Typography,{variant:"h6",className:"text-gray-700 text-center",children:"Select a user to view details."})})]})]}),e.jsxs(t.Dialog,{open:!!p,handler:()=>b(null),children:[e.jsx(t.DialogHeader,{className:"bg-gray-100 text-center py-4",children:e.jsx(t.Typography,{variant:"h5",color:"blue-gray",className:"font-semibold",children:"Confirm Deletion"})}),e.jsxs(t.DialogBody,{className:"flex flex-col items-center gap-6 p-6",children:[e.jsx("div",{className:"p-4 rounded-full bg-red-100 flex justify-center items-center",children:e.jsx(z,{className:"h-10 w-10 text-red-500"})}),e.jsx(t.Typography,{className:"text-center text-base font-medium text-blue-gray-600",children:"Are you sure you want to delete this nutrition plan?"})]}),e.jsxs(t.DialogFooter,{className:"bg-gray-50 flex justify-center gap-4 py-4",children:[e.jsx(t.Button,{variant:"outlined",color:"blue-gray",className:"w-24",onClick:()=>b(null),children:"Cancel"}),e.jsx(t.Button,{variant:"gradient",color:"red",className:"w-24",onClick:R,children:"Confirm"})]})]})]})};export{te as default};
