import{r as m,A as B,_ as y,j as e,a,Z,u as J,b as K,M as ee}from"./index-3cb54544.js";import{S as W}from"./react-select.esm-ec34954b.js";import{P as Y}from"./PencilIcon-57ef2f35.js";import{T as X}from"./TrashIcon-5fb47548.js";import"./assertThisInitialized-82617317.js";const se=["Pre Breakfast","Post Breakfast","Pre Lunch","Post Lunch","Pre Dinner","Post Dinner","Before Sleep at Night","In Every 2-3 hours"],ae=({onAddNutrition:Q,users:_,loading:F,handleCancel:f,editData:c})=>{const[b,H]=m.useState(!1),[p,i]=m.useState((c==null?void 0:c.userId)||""),[C,$]=m.useState([]),[I,S]=m.useState((c==null?void 0:c.mealTime)||""),[T,j]=m.useState((c==null?void 0:c.description)||""),[U,E]=m.useState(""),[w,A]=m.useState({name:(c==null?void 0:c.name)||"",quantity:(c==null?void 0:c.quantity)||1}),[P,k]=m.useState({title:"",quantity:1,userId:""}),[h,v]=m.useState({}),R=()=>{H(!b)};m.useEffect(()=>{p&&D()},[b,p]);const D=()=>{B.get(`/admin/inventory/${p}`).then(s=>{s.data.status==="success"&&($(s.data.data),E(""))}).catch(s=>{var n,u;y.error(((u=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:u.message)||`Failed to ${c!=null&&c._id?"update":"add"} Supplements plan`)})},V=()=>{i(""),S(""),j(""),A({name:"",quantity:1}),v({})},O=s=>{s.preventDefault();let n={};if(p||(n.selectedUser="Please select a user"),I||(n.selectedCategory="Please select a category"),w.name.trim()||(n.itemName="Item name is required"),v(n),Object.keys(n).length>0)return;const u=C.find(l=>l.title===w.name.trim()),t={userId:p,inventoryId:u==null?void 0:u._id,category:I,description:T,items:[{name:w.name.trim(),quantity:w.quantity}]};(c!=null&&c._id?B.put(`/admin/nutrition/${c._id}`,t):B.post("/admin/nutrition",t)).then(l=>{l.data.status==="success"&&(Q(l.data.data),V(),y.success(`Nutrition plan ${c!=null&&c._id?"updated":"added"} successfully!`))}).catch(l=>{var r,d;y.error(((d=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:d.message)||`Failed to ${c!=null&&c._id?"update":"add"} nutrition plan`)})},G=s=>{s.preventDefault(),P.title;const n={userId:p,quantity:P.quantity,title:P.title,inventoryId:U};B.post("/admin/inventory/add/",n).then(u=>{u.data.status==="success"&&(y.success("Inventory added successfully!"),H(!1),k({title:"",userId:""}))}).catch(u=>{var t,o;y.error(((o=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to add inventory")})},z=s=>{if(!s){y.success("Inventory id required!");return}B.delete(`/admin/inventory/delete/${s}`).then(n=>{n.data.status==="success"&&(y.success("Inventory deleted successfully!"),p&&D())}).catch(n=>{var u,t;y.error(((t=(u=n==null?void 0:n.response)==null?void 0:u.data)==null?void 0:t.message)||"Failed to add inventory")})},q=_.filter(s=>s.role==="user").map(s=>({value:s._id,label:`${s.name} (${s.email})`})),M=C.map(s=>({value:s.title,label:s==null?void 0:s.title}));return e.jsxs(a.Dialog,{open:!0,size:"lg",handler:f,dismiss:{enabled:!1},className:"rounded-lg",children:[e.jsx(a.DialogHeader,{className:"bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(a.Typography,{variant:"h5",className:"font-bold",children:b?"Add Inventory":c?"Edit Nutrition Plan":"Add New Supplements Plan"}),b?e.jsx(a.Button,{className:"bg-blue-600 hover:bg-blue-700 text-white rounded-full px-4 py-2  ml-auto",onClick:R,children:"Back"}):e.jsx(a.Button,{className:"bg-blue-600 hover:bg-blue-700 text-white rounded-full px-4 py-2  ml-auto",onClick:R,children:"Add & Manage Inventory"}),e.jsx("button",{onClick:f,className:"hover:bg-white/10 p-1 rounded-full",children:e.jsx(Z,{className:"h-5 w-5"})})]})}),b?e.jsxs(a.DialogBody,{className:"p-6",children:[e.jsx("form",{onSubmit:G,className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(W,{options:q,value:q.find(s=>s.value===p),onChange:s=>{i(s.value),v(n=>({...n,selectedUser:!1}))},placeholder:"Select User",classNamePrefix:"react-select"}),h.selectedUser&&e.jsx(a.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:h.selectedUser})]}),e.jsxs("div",{children:[e.jsx(a.Input,{label:"Title",value:P.title,onChange:s=>{k(n=>({...n,title:s.target.value})),v(n=>({...n,itemName:!1}))},error:!!h.itemName,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"before:content-none after:content-none"}}),h.title&&e.jsx(a.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:h.title})]}),e.jsx(a.Input,{label:"Quantity",type:"number",value:P.quantity,onChange:s=>{k(n=>({...n,quantity:s.target.value}))},error:!!h.quantity,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"before:content-none after:content-none"}}),h.quantity&&e.jsx(a.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:h.quantity})]})}),e.jsx("hr",{className:"mt-3"}),C.length>0&&C.map(s=>e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs(a.Typography,{variant:"small",className:"font-medium text-gray-700",children:[s==null?void 0:s.title,"  - "]}),e.jsxs(a.Typography,{variant:"small",className:"font-semibold text-green-800",children:[(s==null?void 0:s.quantity)||0," "]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(a.Button,{variant:"text",color:"blue",size:"sm",className:"p-1",onClick:()=>{E(s==null?void 0:s._id),k({title:s==null?void 0:s.title,quantity:s==null?void 0:s.quantity}),i(s==null?void 0:s.userId)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(a.Button,{variant:"text",color:"red",size:"sm",className:"p-1",onClick:()=>{z(s==null?void 0:s._id)},children:e.jsx(X,{className:"h-4 w-4"})})]})]}))]}):e.jsx(a.DialogBody,{className:"p-6",children:e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(a.Typography,{variant:"small",className:"font-medium text-gray-700",children:"Select User"}),e.jsx(W,{options:q,value:q.find(s=>s.value===p),onChange:s=>{i(s.value),v(n=>({...n,selectedUser:!1}))},placeholder:"Select a user",classNamePrefix:"react-select"}),h.selectedUser&&e.jsx(a.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:h.selectedUser})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(a.Typography,{variant:"small",className:"font-medium text-gray-700",children:"Meal Time Category"}),e.jsx(a.Select,{value:I,onChange:s=>{S(s),v(n=>({...n,selectedCategory:!1}))},error:!!h.selectedCategory,className:"!border !border-gray-300 focus:!border-blue-500",children:se.map(s=>e.jsx(a.Option,{value:s,className:"hover:bg-blue-50",children:s},s))}),h.selectedCategory&&e.jsx(a.Typography,{variant:"small",color:"red",className:"mt-1 flex items-center gap-1",children:h.selectedCategory})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(a.Typography,{variant:"small",className:"font-medium text-gray-700",children:"Description (optional)"}),e.jsx(a.Textarea,{value:T,onChange:s=>{j(s.target.value),v(n=>({...n,description:!1}))},error:!!h.description,className:"!border !border-gray-300 focus:!border-blue-500",rows:3})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsx(a.Typography,{variant:"h6",color:"blue-gray",className:"font-semibold",children:"Supplements Item Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(a.Typography,{variant:"small",className:"font-medium text-gray-700",children:"Select Inventory"}),e.jsx(W,{options:M,value:M.find(s=>s.value===w.name),onChange:s=>{A(n=>({...n,name:s==null?void 0:s.value}))},placeholder:"Select inventory item",classNamePrefix:"react-select"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(a.Typography,{variant:"small",className:"font-medium text-gray-700",children:"Dose"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(a.Button,{variant:"outlined",size:"sm",color:"blue-gray",className:"w-10 h-10 flex items-center justify-center p-0",onClick:()=>A(s=>({...s,quantity:Math.max(1,s.quantity-1)})),children:"-"}),e.jsx(a.Typography,{className:"w-8 text-center font-bold",children:w.quantity}),e.jsx(a.Button,{variant:"outlined",size:"sm",color:"blue-gray",className:"w-10 h-10 flex items-center justify-center p-0",onClick:()=>A(s=>({...s,quantity:s.quantity+1})),children:"+"})]})]})]})]})]})}),e.jsx(a.DialogFooter,{className:"bg-gray-50 px-6 py-4 rounded-b-lg border-t",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(a.Button,{variant:"text",color:"gray",onClick:f,className:"border border-gray-300 hover:bg-gray-100",children:"Cancel"}),e.jsx(a.Button,{color:"blue",onClick:b?G:O,disabled:F,className:"shadow-md hover:shadow-lg transition-all",children:F?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):b?U?"Update Inventory":"Add Inventory":c?"Update Plan":"Add Plan"})]})})]})},oe=()=>{var s,n,u;const[Q,_]=m.useState([]),[F,f]=m.useState([]),[c,b]=m.useState(""),[H,p]=m.useState(!1),[i,C]=m.useState(null),[$,I]=m.useState(null),[S,T]=m.useState(null),[j,U]=m.useState(1),[E,w]=m.useState(10),{users:A,loading:P}=J(t=>t.users),[k,h]=m.useState(!1),v=K(),R=()=>{p(!1),I(null)},D=()=>{h(!0),B.get("/admin/nutrition").then(t=>{if(t.data.status==="success"){const o=t.data.data.sort((l,r)=>{var d,N,x,g;return(((d=l==null?void 0:l.userDetails)==null?void 0:d.name)||((N=l==null?void 0:l.userDetails)==null?void 0:N.email)).localeCompare(((x=r==null?void 0:r.userDetails)==null?void 0:x.name)||((g=r==null?void 0:r.userDetails)==null?void 0:g.email))});if(_(o),f(o),o.length>0)if(!i)C(o[0]);else{const l=o.find(r=>r.userId===i.userId);l&&C(l)}}else _([]),f([])}).catch(t=>{console.error("Error fetching nutrition data:",t),y.error("Failed to fetch nutrition data.")}).finally(()=>{h(!1)})};m.useEffect(()=>{v(ee({})),D()},[v]);const V=t=>{if(!t||typeof t!="object"||!t._id){y.error("Invalid nutrition data.");return}_(o=>($?o.map(r=>r._id===t._id?t:r):[...o,t]).sort((r,d)=>{var N,x,g,L;return(((N=r==null?void 0:r.userDetails)==null?void 0:N.name)||((x=r==null?void 0:r.userDetails)==null?void 0:x.email)||"").localeCompare(((g=d==null?void 0:d.userDetails)==null?void 0:g.name)||((L=d==null?void 0:d.userDetails)==null?void 0:L.email))})),f(o=>($?o.map(r=>r._id===t._id?t:r):[...o,t]).sort((r,d)=>{var N,x,g,L;return(((N=r==null?void 0:r.userDetails)==null?void 0:N.name)||((x=r==null?void 0:r.userDetails)==null?void 0:x.email)||"").localeCompare(((g=d==null?void 0:d.userDetails)==null?void 0:g.name)||((L=d==null?void 0:d.userDetails)==null?void 0:L.email))})),p(!1),I(null),D()},O=()=>{S&&B.delete(`/admin/nutrition/${S}`).then(t=>{t.data.status==="success"&&(_(o=>o.filter(l=>l._id!==S)),f(o=>o.filter(l=>l._id!==S)),D(),y.success("Nutrition plan deleted successfully."))}).catch(t=>{console.error("Error deleting nutrition plan:",t),y.error("Failed to delete nutrition plan.")}).finally(()=>T(null))},G=t=>{const o=t.target.value.toLowerCase();if(b(o),o==="")f(Q);else{const l=Q.filter(r=>{var x,g;const d=((x=r==null?void 0:r.userDetails)==null?void 0:x.name)||"",N=((g=r==null?void 0:r.userDetails)==null?void 0:g.email)||"";return(d+N).toLowerCase().includes(o)});f(l)}U(1)},z=Math.ceil(F.length/E),q=F.slice((j-1)*E,j*E),M=t=>{t>0&&t<=z&&U(t)};return e.jsxs("div",{className:"mt-8 mb-8 flex flex-col items-center",children:[e.jsxs(a.Card,{className:"w-full max-w-6xl shadow-lg mb-6",children:[e.jsxs(a.CardHeader,{variant:"gradient",className:"bg-gradient-to-r from-blue-600 to-indigo-800 p-6 rounded-t-lg flex justify-between items-center",children:[e.jsx(a.Typography,{variant:"h5",color:"white",className:"font-bold",children:"Supplements Management"}),e.jsx(a.Button,{color:"white",onClick:()=>p(!0),className:"shadow-md hover:shadow-lg transition-all",children:"Add Supplements Plan"})]}),H?e.jsx(ae,{onAddNutrition:V,users:A,loading:P,handleCancel:R,editData:$}):e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"w-full md:w-1/4 border-r p-4 bg-gray-50",children:[e.jsx("div",{className:"mb-6",children:e.jsx(a.Input,{type:"text",placeholder:"Search users...",value:c,onChange:G,className:"!border !border-gray-300 focus:!border-blue-500",labelProps:{className:"hidden"},containerProps:{className:"min-w-[100px]"}})}),k?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(a.Typography,{variant:"small",className:"text-gray-600",children:"Loading users..."})}):q.length>0?e.jsx("div",{className:"space-y-2",children:q.map((t,o)=>{var l,r;return e.jsx("div",{className:`p-3 cursor-pointer rounded-lg transition-all ${(i==null?void 0:i.userId)===t.userId?"bg-blue-100 border-l-4 border-blue-500":"hover:bg-gray-100 border-l-4 border-transparent"}`,onClick:()=>C(t),children:e.jsxs(a.Typography,{variant:"small",className:"font-semibold",children:[o+1,". ",((l=t==null?void 0:t.userDetails)==null?void 0:l.name)||((r=t==null?void 0:t.userDetails)==null?void 0:r.email)]})},t.userId)})}):e.jsx("div",{className:"p-4 text-center bg-gray-100 rounded-lg",children:e.jsx(a.Typography,{variant:"small",className:"text-gray-600",children:"No users found"})}),z>1&&e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(a.Button,{variant:"outlined",color:"blue",size:"sm",onClick:()=>M(j-1),disabled:j===1,children:"Previous"}),e.jsxs(a.Typography,{variant:"small",color:"gray",children:["Page ",j," of ",z]}),e.jsx(a.Button,{variant:"outlined",color:"blue",size:"sm",onClick:()=>M(j+1),disabled:j===z,children:"Next"})]})]}),e.jsx("div",{className:"w-full md:w-3/4 p-4",children:k?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(a.Typography,{variant:"small",className:"text-gray-600",children:"Loading nutrition details..."})}):i?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx(a.Typography,{variant:"h6",color:"blue-gray",className:"font-bold",children:((s=i==null?void 0:i.userDetails)==null?void 0:s.name)||((n=i==null?void 0:i.userDetails)==null?void 0:n.email)}),e.jsx(a.Typography,{variant:"small",color:"gray",children:"Nutrition Plan Details"})]}),(u=i==null?void 0:i.mealTimeGroups)==null?void 0:u.map((t,o)=>e.jsxs(a.Card,{className:"mb-6 shadow-sm border",children:[e.jsx(a.CardHeader,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 border-b",floated:!1,shadow:!1,children:e.jsx(a.Typography,{variant:"h6",color:"blue-gray",className:"font-semibold uppercase",children:t.mealTime})}),e.jsx(a.CardBody,{className:"p-0",children:t.nutritionDetails.map((l,r)=>e.jsx("div",{className:"border-b last:border-none p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(a.Typography,{variant:"h6",className:"font-semibold text-blue-800",children:l.name}),l.description&&e.jsx(a.Typography,{variant:"small",className:"text-gray-600 mt-1",children:l.description})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[e.jsx("div",{className:"bg-blue-50 px-3 py-1 rounded-full",children:e.jsxs(a.Typography,{variant:"small",className:"font-semibold text-blue-800",children:["Total Stock: ",l==null?void 0:l.stockQuantity]})}),e.jsx("div",{className:"bg-blue-50 px-3 py-1 rounded-full",children:e.jsxs(a.Typography,{variant:"small",className:"font-semibold text-blue-800",children:["Remaining Stock: ",(l==null?void 0:l.stockQuantity)-(l==null?void 0:l.takenCount)]})}),e.jsx("div",{className:"bg-green-50 px-3 py-1 rounded-full",children:e.jsxs(a.Typography,{variant:"small",className:"font-semibold text-green-800",children:["Used: ",(l==null?void 0:l.takenCount)||0]})}),e.jsx("div",{className:"bg-green-50 px-3 py-1 rounded-full",children:e.jsxs(a.Typography,{variant:"small",className:"font-semibold text-green-800",children:["Daily Dose: ",(l==null?void 0:l.quantity)||0]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a.Button,{variant:"text",color:"blue",size:"sm",className:"p-1",onClick:()=>{I({...l,userId:i.userId}),p(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(a.Button,{variant:"text",color:"red",size:"sm",className:"p-1",onClick:()=>T(l._id),children:e.jsx(X,{className:"h-4 w-4"})})]})]})]})},r))})]},o))]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(a.Typography,{variant:"h6",color:"gray",className:"mb-2",children:"No user selected"}),e.jsx(a.Typography,{variant:"small",color:"gray",children:"Select a user from the list to view nutrition details"})]})})]})]}),e.jsxs(a.Dialog,{open:!!S,handler:()=>T(null),children:[e.jsx(a.DialogHeader,{className:"bg-gray-100 text-center py-4",children:e.jsx(a.Typography,{variant:"h5",color:"blue-gray",className:"font-semibold",children:"Confirm Deletion"})}),e.jsxs(a.DialogBody,{className:"flex flex-col items-center gap-6 p-6",children:[e.jsx("div",{className:"p-4 rounded-full bg-red-100 flex justify-center items-center",children:e.jsx(X,{className:"h-10 w-10 text-red-500"})}),e.jsx(a.Typography,{className:"text-center text-base font-medium text-blue-gray-600",children:"Are you sure you want to delete this nutrition item? This action cannot be undone."})]}),e.jsxs(a.DialogFooter,{className:"bg-gray-50 flex justify-center gap-4 py-4",children:[e.jsx(a.Button,{variant:"outlined",color:"blue-gray",onClick:()=>T(null),className:"w-24",children:"Cancel"}),e.jsx(a.Button,{variant:"gradient",color:"red",onClick:O,className:"w-24",children:"Delete"})]})]})]})};export{oe as default};
